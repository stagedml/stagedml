
<!DOCTYPE html>
<HTML>
<HEAD>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/LaTeX", "output/HTML-CSS"],
    "HTML-CSS": { availableFonts: ["TeX"] }
    });
</script>

<script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<style>

@font-face {
  font-family: 'Raleway';
  font-style: normal;
  font-weight: 300;
  src: local('Raleway Light'), local('Raleway-Light'), url(http://fonts.gstatic.com/s/raleway/v9/-_Ctzj9b56b8RgXW8FArifk_vArhqVIZ0nv9q090hN8.woff2) format('woff2');
}
@font-face {
  font-family: 'Raleway';
  font-style: normal;
  font-weight: 400;
  src: local('Raleway'), url(http://fonts.gstatic.com/s/raleway/v9/0dTEPzkLWceF7z0koJaX1A.woff2) format('woff2');
}
@font-face {
  font-family: 'Raleway';
  font-style: normal;
  font-weight: 600;
  src: local('Raleway SemiBold'), local('Raleway-SemiBold'), url(http://fonts.gstatic.com/s/raleway/v9/xkvoNo9fC8O2RDydKj12b_k_vArhqVIZ0nv9q090hN8.woff2) format('woff2');
}
html {
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}
audio:not([controls]) {
  display: none;
  height: 0;
}
[hidden],
template {
  display: none;
}
a:active,
a:hover {
  outline: 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 1em 40px;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}
pre {
  overflow: auto;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
button,
input,
optgroup,
select,
textarea {
  color: inherit; /* 1 */
  font: inherit; /* 2 */
  margin: 0; /* 3 */
}
button {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button; /* 2 */
  cursor: pointer; /* 3 */
}
button[disabled],
html input[disabled] {
  cursor: default;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
input {
  line-height: normal;
}
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box; /* 2 */
  box-sizing: content-box;
}
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0; /* 1 */
  padding: 0; /* 2 */
}
textarea {
  overflow: auto;
}
optgroup {
  font-weight: bold;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}
td,
th {
  padding: 0;
}


/*
* Skeleton V2.0.4
* Copyright 2014, Dave Gamache
* www.getskeleton.com
* Free to use under the MIT license.
* http://www.opensource.org/licenses/mit-license.php
* 12/29/2014
*/
.container {
  position: relative;
  width: 100%;
  max-width: 960px;
  margin: 0 auto;
  padding: 0 20px;
  box-sizing: border-box; }
.column,
.columns {
  width: 100%;
  float: left;
  box-sizing: border-box; }
@media (min-width: 400px) {
  .container {
    width: 85%;
    padding: 0; }
}
@media (min-width: 550px) {
  .container {
    width: 80%; }
  .column,
  .columns {
    margin-left: 4%; }
  .column:first-child,
  .columns:first-child {
    margin-left: 0; }

  .one.column,
  .one.columns                    { width: 4.66666666667%; }
  .two.columns                    { width: 13.3333333333%; }
  .three.columns                  { width: 22%;            }
  .four.columns                   { width: 30.6666666667%; }
  .five.columns                   { width: 39.3333333333%; }
  .six.columns                    { width: 48%;            }
  .seven.columns                  { width: 56.6666666667%; }
  .eight.columns                  { width: 65.3333333333%; }
  .nine.columns                   { width: 74.0%;          }
  .ten.columns                    { width: 82.6666666667%; }
  .eleven.columns                 { width: 91.3333333333%; }
  .twelve.columns                 { width: 100%; margin-left: 0; }

  .one-third.column               { width: 30.6666666667%; }
  .two-thirds.column              { width: 65.3333333333%; }

  .one-half.column                { width: 48%; }

  /* Offsets */
  .offset-by-one.column,
  .offset-by-one.columns          { margin-left: 8.66666666667%; }
  .offset-by-two.column,
  .offset-by-two.columns          { margin-left: 17.3333333333%; }
  .offset-by-three.column,
  .offset-by-three.columns        { margin-left: 26%;            }
  .offset-by-four.column,
  .offset-by-four.columns         { margin-left: 34.6666666667%; }
  .offset-by-five.column,
  .offset-by-five.columns         { margin-left: 43.3333333333%; }
  .offset-by-six.column,
  .offset-by-six.columns          { margin-left: 52%;            }
  .offset-by-seven.column,
  .offset-by-seven.columns        { margin-left: 60.6666666667%; }
  .offset-by-eight.column,
  .offset-by-eight.columns        { margin-left: 69.3333333333%; }
  .offset-by-nine.column,
  .offset-by-nine.columns         { margin-left: 78.0%;          }
  .offset-by-ten.column,
  .offset-by-ten.columns          { margin-left: 86.6666666667%; }
  .offset-by-eleven.column,
  .offset-by-eleven.columns       { margin-left: 95.3333333333%; }

  .offset-by-one-third.column,
  .offset-by-one-third.columns    { margin-left: 34.6666666667%; }
  .offset-by-two-thirds.column,
  .offset-by-two-thirds.columns   { margin-left: 69.3333333333%; }

  .offset-by-one-half.column,
  .offset-by-one-half.columns     { margin-left: 52%; }

}
html {
  font-size: 62.5%; }
body {
  font-size: 1.5em; /* currently ems cause chrome bug misinterpreting rems on body element */
  line-height: 1.6;
  font-weight: 400;
  font-family: "Raleway", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #222; }
h1, h2, h3, h4, h5, h6 {
  margin-top: 0;
  margin-bottom: 2rem;
  font-weight: 300; }
h1 { font-size: 3.6rem; line-height: 1.2;  letter-spacing: -.1rem;}
h2 { font-size: 3.4rem; line-height: 1.25; letter-spacing: -.1rem; }
h3 { font-size: 3.2rem; line-height: 1.3;  letter-spacing: -.1rem; }
h4 { font-size: 2.8rem; line-height: 1.35; letter-spacing: -.08rem; }
h5 { font-size: 2.4rem; line-height: 1.5;  letter-spacing: -.05rem; }
h6 { font-size: 1.5rem; line-height: 1.6;  letter-spacing: 0; }

p {
  margin-top: 0; }
a {
  color: #1EAEDB; }
a:hover {
  color: #0FA0CE; }
.button,
button,
input[type="submit"],
input[type="reset"],
input[type="button"] {
  display: inline-block;
  height: 38px;
  padding: 0 30px;
  color: #555;
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  line-height: 38px;
  letter-spacing: .1rem;
  text-transform: uppercase;
  text-decoration: none;
  white-space: nowrap;
  background-color: transparent;
  border-radius: 4px;
  border: 1px solid #bbb;
  cursor: pointer;
  box-sizing: border-box; }
.button:hover,
button:hover,
input[type="submit"]:hover,
input[type="reset"]:hover,
input[type="button"]:hover,
.button:focus,
button:focus,
input[type="submit"]:focus,
input[type="reset"]:focus,
input[type="button"]:focus {
  color: #333;
  border-color: #888;
  outline: 0; }
.button.button-primary,
button.button-primary,
input[type="submit"].button-primary,
input[type="reset"].button-primary,
input[type="button"].button-primary {
  color: #FFF;
  background-color: #33C3F0;
  border-color: #33C3F0; }
.button.button-primary:hover,
button.button-primary:hover,
input[type="submit"].button-primary:hover,
input[type="reset"].button-primary:hover,
input[type="button"].button-primary:hover,
.button.button-primary:focus,
button.button-primary:focus,
input[type="submit"].button-primary:focus,
input[type="reset"].button-primary:focus,
input[type="button"].button-primary:focus {
  color: #FFF;
  background-color: #1EAEDB;
  border-color: #1EAEDB; }
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea,
select {
  height: 38px;
  padding: 6px 10px; /* The 6px vertically centers text on FF, ignored by Webkit */
  background-color: #fff;
  border: 1px solid #D1D1D1;
  border-radius: 4px;
  box-shadow: none;
  box-sizing: border-box; }
/* Removes awkward default styles on some inputs for iOS */
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea {
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none; }
textarea {
  min-height: 65px;
  padding-top: 6px;
  padding-bottom: 6px; }
input[type="email"]:focus,
input[type="number"]:focus,
input[type="search"]:focus,
input[type="text"]:focus,
input[type="tel"]:focus,
input[type="url"]:focus,
input[type="password"]:focus,
textarea:focus,
select:focus {
  border: 1px solid #33C3F0;
  outline: 0; }
label,
legend {
  display: block;
  margin-bottom: .5rem;
  font-weight: 600; }
fieldset {
  padding: 0;
  border-width: 0; }
input[type="checkbox"],
input[type="radio"] {
  display: inline; }
label > .label-body {
  display: inline-block;
  margin-left: .5rem;
  font-weight: normal; }
ul {
  list-style: circle inside; }
ol {
  list-style: decimal inside; }
ol, ul {
  padding-left: 0;
  margin-top: 0; }
ul ul,
ul ol,
ol ol,
ol ul {
  margin: 1.5rem 0 1.5rem 3rem;
  font-size: 90%; }
li {
  margin-bottom: 1rem; }
th,
td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #E1E1E1; }
th:first-child,
td:first-child {
  padding-left: 0; }
th:last-child,
td:last-child {
  padding-right: 0; }
button,
.button {
  margin-bottom: 1rem; }
input,
textarea,
select,
fieldset {
  margin-bottom: 1.5rem; }
pre,
blockquote,
dl,
figure,
table,
p,
ul,
ol,
form {
  margin-bottom: 2.5rem; }
.u-full-width {
  width: 100%;
  box-sizing: border-box; }
.u-max-full-width {
  max-width: 100%;
  box-sizing: border-box; }
.u-pull-right {
  float: right; }
.u-pull-left {
  float: left; }
hr {
  margin-top: 3rem;
  margin-bottom: 3.5rem;
  border-width: 0;
  border-top: 1px solid #E1E1E1; }
.container:after,
.row:after,
.u-cf {
  content: "";
  display: table;
  clear: both; }

pre {
  display: block;
  padding: 9.5px;
  margin: 0 0 10px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #333;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}
code,
kbd,
pre,
samp {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
}
code {
  padding: 2px 4px;
  font-size: 90%;
  color: #c7254e;
  background-color: #f9f2f4;
  border-radius: 4px;
}

@media (min-width: 400px) {}
@media (min-width: 550px) {}
@media (min-width: 750px) {}
@media (min-width: 1000px) {}
@media (min-width: 1200px) {}

</style>

<style>
.hll { background-color: #ffffcc }
.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #888888 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>





<style>
h1.title {margin-top : 20px}
img {max-width : 100%}

#From nbconvert
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>

</HEAD>
<BODY>
    <div class ="container">
        <div class = "row">
            <div class = "col-md-12 twelve columns">
<h1>NL2Bash experiment</h1>
<p>This document describes the results of applying Official Trnasformer of the
TensorFlow ([link][1])
to the NL2Bash dataset described in the [NL2Bash: A Corpus and Semantic Parser
for Natural Language Interface to the Linux Operating
System][2].</p>
<h2>Imports</h2>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span>
<span class="kn">from</span> <span class="nn">pylightnix</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RRef</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">realize</span><span class="p">,</span> <span class="n">instantiate</span><span class="p">,</span> <span class="n">redefine</span><span class="p">,</span> <span class="n">mkconfig</span><span class="p">,</span> <span class="n">promise</span><span class="p">,</span> <span class="n">rref2dref</span><span class="p">,</span>
    <span class="n">mksymlink</span><span class="p">,</span> <span class="n">rref2path</span><span class="p">,</span> <span class="n">mklens</span> <span class="p">)</span>
<span class="kn">from</span> <span class="nn">stagedml.imports</span> <span class="kn">import</span> <span class="p">(</span> <span class="n">environ</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">makedirs</span> <span class="p">)</span>
<span class="kn">from</span> <span class="nn">stagedml.stages.all</span> <span class="kn">import</span> <span class="p">(</span> <span class="n">transformer_wmt</span><span class="p">,</span> <span class="n">all_nl2bashsubtok</span><span class="p">,</span>
    <span class="n">all_fetchnl2bash</span> <span class="p">)</span>
<span class="kn">from</span> <span class="nn">analyze</span> <span class="kn">import</span> <span class="p">(</span> <span class="n">read_tensorflow_log</span> <span class="p">)</span>

<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;tensorflow&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">KeyboardInterrupt</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-7afc49a3c4dc&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>
mksymlink, rref2path, mklens )
<span class="ansi-green-intense-fg ansi-bold">      8</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>imports <span class="ansi-green-fg">import</span> <span
class="ansi-blue-fg">(</span> environ<span class="ansi-blue-
fg">,</span> join<span class="ansi-blue-fg">,</span> environ<span
class="ansi-blue-fg">,</span> makedirs <span class="ansi-blue-
fg">)</span>
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-
fg"> from stagedml.stages.all import ( transformer_wmt,
all_nl2bashsubtok,
</span><span class="ansi-green-intense-fg ansi-bold">     10</span>
all_fetchnl2bash )
<span class="ansi-green-intense-fg ansi-bold">     11</span> <span
class="ansi-green-fg">from</span> analyze <span class="ansi-green-
fg">import</span> <span class="ansi-blue-fg">(</span>
read_tensorflow_log <span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/stages/all.py</span> in <span class="ansi-cyan-
fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     23</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-
fg">.</span>bert_finetune_squad <span class="ansi-green-
fg">import</span> bert_finetune_squad11
<span class="ansi-green-intense-fg ansi-bold">     24</span> <span
class="ansi-red-fg"># from stagedml.stages.nl2bash.all import
nl2bash</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-
fg"> </span><span class="ansi-green-fg">from</span> stagedml<span
class="ansi-blue-fg">.</span>stages<span class="ansi-blue-
fg">.</span>fetchnl2bash <span class="ansi-green-fg">import</span>
fetchnl2bash<span class="ansi-blue-fg">,</span> nl2bashSubtok
<span class="ansi-green-intense-fg ansi-bold">     26</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-fg">.</span>fetchwmt <span
class="ansi-green-fg">import</span> wmtsubtok<span class="ansi-blue-
fg">,</span> wmtsubtokInv
<span class="ansi-green-intense-fg ansi-bold">     27</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-fg">.</span>transformer_wmt
<span class="ansi-green-fg">import</span> transformer_wmt
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/stages/fetchnl2bash.py</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>types <span class="ansi-green-fg">import</span> <span
class="ansi-blue-fg">(</span> Optional<span class="ansi-blue-
fg">,</span>Any<span class="ansi-blue-fg">,</span>List<span
class="ansi-blue-fg">,</span>Tuple<span class="ansi-blue-
fg">,</span>Union<span class="ansi-blue-fg">,</span> WmtSubtok<span
class="ansi-blue-fg">,</span> Set <span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-fg">.</span>files <span
class="ansi-green-fg">import</span> <span class="ansi-blue-
fg">(</span> splitfile<span class="ansi-blue-fg">,</span> lineshuffle
<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 14</span><span class="ansi-red-
fg"> </span><span class="ansi-green-fg">from</span> stagedml<span
class="ansi-blue-fg">.</span>stages<span class="ansi-blue-
fg">.</span>fetchwmt <span class="ansi-green-fg">import</span> <span
class="ansi-blue-fg">(</span> wmtsubtok_ <span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span> from
official.nlp.transformer.utils.tokenizer import ( EOS_ID,
Subtokenizer,
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/stages/fetchwmt.py</span> in <span class="ansi-cyan-
fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>imports <span class="ansi-green-fg">import</span> <span
class="ansi-blue-fg">(</span> join <span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-
fg"> from stagedml.models.transformer.imports import ( Subtokenizer,
</span><span class="ansi-green-intense-fg ansi-bold">      9</span>
encode_and_save_files, RESERVED_TOKENS )
<span class="ansi-green-intense-fg ansi-bold">     10</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>utils<span class="ansi-blue-fg">.</span>files <span
class="ansi-green-fg">import</span> <span class="ansi-blue-
fg">(</span> flines<span class="ansi-blue-fg">,</span> readlines<span
class="ansi-blue-fg">,</span> writelines <span class="ansi-blue-
fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/models/transformer/__init__.py</span> in <span
class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-
fg"> </span><span class="ansi-green-fg">from</span> <span class="ansi-
blue-fg">.</span>imports <span class="ansi-green-fg">import</span>
<span class="ansi-blue-fg">*</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span
class="ansi-green-fg">from</span> <span class="ansi-blue-
fg">.</span>model <span class="ansi-green-fg">import</span> <span
class="ansi-blue-fg">*</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span
class="ansi-green-fg">from</span> <span class="ansi-blue-
fg">.</span>data <span class="ansi-green-fg">import</span> <span
class="ansi-blue-fg">*</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/models/transformer/imports.py</span> in <span
class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span>
padded_sequence_accuracy, transformer_loss )
<span class="ansi-green-intense-fg ansi-bold">     14</span> <span
class="ansi-green-fg">from</span> official<span class="ansi-blue-
fg">.</span>nlp<span class="ansi-blue-fg">.</span>transformer<span
class="ansi-blue-fg">.</span>beam_search <span class="ansi-green-
fg">import</span> sequence_beam_search
<span class="ansi-green-fg">---&gt; 15</span><span class="ansi-red-
fg"> from official.nlp.transformer.utils.tokenizer import ( EOS_ID,
Subtokenizer,
</span><span class="ansi-green-intense-fg ansi-bold">     16</span>
RESERVED_TOKENS )
<span class="ansi-green-intense-fg ansi-bold">     17</span> <span
class="ansi-green-fg">from</span> official<span class="ansi-blue-
fg">.</span>nlp<span class="ansi-blue-fg">.</span>transformer<span
class="ansi-blue-fg">.</span>utils<span class="ansi-blue-
fg">.</span>metrics <span class="ansi-green-fg">import</span>
compute_bleu
<span class="ansi-green-fg">~/.local/lib/python3.6/site-
packages/official/nlp/transformer/utils/tokenizer.py</span> in <span
class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     53</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span> <span
class="ansi-red-fg"># Set contains all letter and number
characters.</span>
<span class="ansi-green-fg">---&gt; 55</span><span class="ansi-red-
fg"> </span>_ALPHANUMERIC_CHAR_SET <span class="ansi-blue-fg">=</span>
alphanumeric_char_set<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     56</span>
<span class="ansi-green-intense-fg ansi-bold">     57</span> <span
class="ansi-red-fg"># min_count is the minimum number of times a
subtoken must appear in the data</span>
<span class="ansi-green-fg">~/.local/lib/python3.6/site-
packages/official/nlp/transformer/utils/tokenizer.py</span> in <span
class="ansi-cyan-fg">alphanumeric_char_set</span><span class="ansi-
blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span> <span
class="ansi-green-fg">def</span> alphanumeric_char_set<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>   return
set(
<span class="ansi-green-fg">---&gt; 50</span><span class="ansi-red-
fg">     </span>six<span class="ansi-blue-fg">.</span>unichr<span
class="ansi-blue-fg">(</span>i<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">for</span> i <span class="ansi-green-
fg">in</span> xrange<span class="ansi-blue-fg">(</span>sys<span
class="ansi-blue-fg">.</span>maxunicode<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>     if
(unicodedata.category(six.unichr(i)).startswith(&#34;L&#34;) or
<span class="ansi-green-intense-fg ansi-bold">     52</span>
unicodedata.category(six.unichr(i)).startswith(&#34;N&#34;)))
<span class="ansi-green-fg">~/.local/lib/python3.6/site-
packages/official/nlp/transformer/utils/tokenizer.py</span> in <span
class="ansi-cyan-fg">&lt;genexpr&gt;</span><span class="ansi-blue-
fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">     50</span>
six<span class="ansi-blue-fg">.</span>unichr<span class="ansi-blue-
fg">(</span>i<span class="ansi-blue-fg">)</span> <span class="ansi-
green-fg">for</span> i <span class="ansi-green-fg">in</span>
xrange<span class="ansi-blue-fg">(</span>sys<span class="ansi-blue-
fg">.</span>maxunicode<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>     if
(unicodedata.category(six.unichr(i)).startswith(&#34;L&#34;) or
<span class="ansi-green-fg">---&gt; 52</span><span class="ansi-red-
fg">
unicodedata.category(six.unichr(i)).startswith(&#34;N&#34;)))
</span><span class="ansi-green-intense-fg ansi-bold">     53</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span> <span
class="ansi-red-fg"># Set contains all letter and number
characters.</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div>

<h2>Intro</h2>
<p>The primary goal of this work is to demonstrate the features of [StagedML
library][3]. The secondary goal is to evaluate the
<a href="https://github.com/stagedml/nl2bash_essence/tree/master/src/data/bash">NL2BASH</a>
dataset.</p>
<p>In particular, we want to highlight the following facts:</p>
<ol>
<li>The sinppets of top-level code are only one-screen long. At the same time, it
   allows the programmer to change every aspect of the experiment by connecting
   stages together and tweaking their parameters.</li>
<li>StagedML caches the results of running stages by creating immutable objects
   in the Pylightnix storage. Configurations and training results are
   accessible to users via [Pylightnix][4] API.</li>
<li>Consequently, the rendering of the experiment reports may be largely authomatized.
   In this work, we generated reports from scrath by running a <code>Makefile</code> in the
   <a href="/run/nl2bash">/run/nl2bash</a> directory.</li>
</ol>
<p>The source files of this report are
<a href="https://github.com/stagedml/stagedml/tree/master/run/nl2bash/Report.md.in">available</a>
in StagedML repository. We used <a href="http://mpastell.com/pweave">PWeave</a> to render
this report.</p>
<h3>The Model</h3>
<p>In this work, we trained an close copy of official Transformer of the
TensorFlow, using the <a href="https://github.com/stagedml/nl2bash_essence/tree/master/src/data/bash">NL2BASH
dataset</a>
inroduced by the [NL2BASH paper][2].</p>
<p>The TensorFlow code of the model is located in the
<a href="/src/stagedml/stages/transformer_wmt.py">transformer_wmt.py</a> file. We define
the <code>TransformerBuild</code> class for storing the mutable state and the number of
operations, including <code>build</code>, <code>train</code>, <code>evaluate</code>, etc for actions of the same
name.  Every operation typically accepts <code>TransformerBuild</code> object and the index
of the model instance.</p>
<p>Finally, we define Pylightnix Stage function <code>transformer_wmt</code> which wraps those
actions. It's arguments are:</p>
<ul>
<li><code>m</code> Pylightnix dependency resolution context.</li>
<li><code>wmt:WmtSubtok</code> reference to an upstream stage providing a tokenizer and a
  dataset</li>
<li><code>num_instances:int=1</code> the number of instances to train.</li>
</ul>
<h3>Dataset</h3>
<p>We print top 10 lines of input and target sentences of the Dataset.</p>

<div class="highlight"><pre><span></span><span class="n">rref</span><span class="o">=</span><span class="n">realize</span><span class="p">(</span><span class="n">instantiate</span><span class="p">(</span><span class="n">all_fetchnl2bash</span><span class="p">))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mklens</span><span class="p">(</span><span class="n">rref</span><span class="p">)</span><span class="o">.</span><span class="n">train_input_combined</span><span class="o">.</span><span class="n">syspath</span><span class="p">)</span> <span class="k">as</span> <span class="n">inp</span><span class="p">,</span> \
     <span class="nb">open</span><span class="p">(</span><span class="n">mklens</span><span class="p">(</span><span class="n">rref</span><span class="p">)</span><span class="o">.</span><span class="n">train_target_combined</span><span class="o">.</span><span class="n">syspath</span><span class="p">)</span> <span class="k">as</span> <span class="n">tgt</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">iline</span><span class="p">,</span> <span class="n">tline</span><span class="p">)</span> <span class="ow">in</span> <span class="n">islice</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span><span class="n">tgt</span><span class="p">)),</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#{i}</span><span class="se">\n</span><span class="s2">Input: {iline.strip()}</span><span class="se">\n\n</span><span class="s2">Target: {tline.strip()}&quot;</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">NameError</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-13b1b7219e33&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-
fg"> </span>rref<span class="ansi-blue-fg">=</span>realize<span
class="ansi-blue-fg">(</span>instantiate<span class="ansi-blue-
fg">(</span>all_fetchnl2bash<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span
class="ansi-green-fg">with</span> open<span class="ansi-blue-
fg">(</span>mklens<span class="ansi-blue-fg">(</span>rref<span
class="ansi-blue-fg">)</span><span class="ansi-blue-
fg">.</span>train_input_combined<span class="ansi-blue-
fg">.</span>syspath<span class="ansi-blue-fg">)</span> <span
class="ansi-green-fg">as</span> inp<span class="ansi-blue-
fg">,</span><span class="ansi-red-fg"> </span><span class="ansi-red-
fg">\</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>
open<span class="ansi-blue-fg">(</span>mklens<span class="ansi-blue-
fg">(</span>rref<span class="ansi-blue-fg">)</span><span class="ansi-
blue-fg">.</span>train_target_combined<span class="ansi-blue-
fg">.</span>syspath<span class="ansi-blue-fg">)</span> <span
class="ansi-green-fg">as</span> tgt<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>   <span
class="ansi-green-fg">for</span> i<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">(</span>iline<span class="ansi-blue-
fg">,</span> tline<span class="ansi-blue-fg">)</span> <span
class="ansi-green-fg">in</span> islice<span class="ansi-blue-
fg">(</span>enumerate<span class="ansi-blue-fg">(</span>zip<span
class="ansi-blue-fg">(</span>inp<span class="ansi-blue-
fg">,</span>tgt<span class="ansi-blue-fg">)</span><span class="ansi-
blue-fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-
cyan-fg">10</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-red-fg">NameError</span>: name
&#39;all_fetchnl2bash&#39; is not defined
</pre></div>

<h3>Metrics</h3>
<p>To report the model performance we used BLEU metrics, as implemented in
TensorFlow official Trnasformer model. This metric may differs from the version
of BLEU which were used by the authors of NL2BASH paper[2][2], so we can't
compare results directly.</p>
<p>We applied the metrics to the evaluation subset of the NL2Bash dataset which is
a <code>0.1</code> part of the original dataset.</p>
<h3>Experiments</h3>
<ol>
<li><a href="#baseline-transformer">Baseline Transformer</a> -  use default upstream settings</li>
<li><a href="#unshuffled-transformer">Unshuffled Transformer</a> -  don't shuffle the dataset</li>
<li><a href="#bash-specific-tokens">Bash specific tokens</a> - add all commands and flags to
   the list of subtokens</li>
<li><a href="#changing-vocabulary-size">Changing vocabulary size</a> - try different target
   sizes of vocabulary</li>
<li><a href="#single-char-punctuation-tokens">Single-char punctuation tokens</a> - suppress
   multichar punktuation subtokens</li>
</ol>
<h2>Baseline transformer</h2>
<p>Below we define the top-level code which sets task-specific parameters of the
<code>transformer_wmt</code> stage.</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylightnix</span> <span class="kn">import</span> <span class="p">(</span> <span class="n">RRef</span><span class="p">,</span> <span class="n">realizeMany</span><span class="p">,</span> <span class="n">instantiate</span><span class="p">,</span> <span class="n">redefine</span><span class="p">,</span> <span class="n">mkconfig</span><span class="p">,</span>
    <span class="n">mksymlink</span><span class="p">,</span> <span class="n">match_some</span> <span class="p">)</span>
<span class="kn">from</span> <span class="nn">stagedml.stages.all</span> <span class="kn">import</span> <span class="n">transformer_wmt</span><span class="p">,</span> <span class="n">all_nl2bashsubtok</span>

<span class="k">def</span> <span class="nf">baseline_subtok</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">all_nl2bashsubtok</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="n">with_bash_charset</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                              <span class="n">with_bash_subtokens</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">baseline_transformer</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;train_steps&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="mi">5000</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;beam_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">3</span> <span class="c1"># As in Tellina paper</span>
    <span class="k">return</span> <span class="n">mkconfig</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">redefine</span><span class="p">(</span><span class="n">transformer_wmt</span><span class="p">,</span>
                  <span class="n">new_config</span><span class="o">=</span><span class="n">_config</span><span class="p">,</span>
                  <span class="n">new_matcher</span><span class="o">=</span><span class="n">match_some</span><span class="p">())(</span><span class="n">m</span><span class="p">,</span> <span class="n">baseline_subtok</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">num_instances</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">KeyboardInterrupt</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-1049725cc3b9&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> from
pylightnix import ( RRef, realizeMany, instantiate, redefine,
mkconfig,
<span class="ansi-green-intense-fg ansi-bold">      2</span>
mksymlink, match_some )
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-
fg"> </span><span class="ansi-green-fg">from</span> stagedml<span
class="ansi-blue-fg">.</span>stages<span class="ansi-blue-
fg">.</span>all <span class="ansi-green-fg">import</span>
transformer_wmt<span class="ansi-blue-fg">,</span> all_nl2bashsubtok
<span class="ansi-green-intense-fg ansi-bold">      4</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span
class="ansi-green-fg">def</span> baseline_subtok<span class="ansi-
blue-fg">(</span>m<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/stages/all.py</span> in <span class="ansi-cyan-
fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     23</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-
fg">.</span>bert_finetune_squad <span class="ansi-green-
fg">import</span> bert_finetune_squad11
<span class="ansi-green-intense-fg ansi-bold">     24</span> <span
class="ansi-red-fg"># from stagedml.stages.nl2bash.all import
nl2bash</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-
fg"> </span><span class="ansi-green-fg">from</span> stagedml<span
class="ansi-blue-fg">.</span>stages<span class="ansi-blue-
fg">.</span>fetchnl2bash <span class="ansi-green-fg">import</span>
fetchnl2bash<span class="ansi-blue-fg">,</span> nl2bashSubtok
<span class="ansi-green-intense-fg ansi-bold">     26</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-fg">.</span>fetchwmt <span
class="ansi-green-fg">import</span> wmtsubtok<span class="ansi-blue-
fg">,</span> wmtsubtokInv
<span class="ansi-green-intense-fg ansi-bold">     27</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-fg">.</span>transformer_wmt
<span class="ansi-green-fg">import</span> transformer_wmt
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/stages/fetchnl2bash.py</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     17</span>
alphanumeric_char_set, RESERVED_TOKENS )
<span class="ansi-green-intense-fg ansi-bold">     18</span>
<span class="ansi-green-fg">---&gt; 19</span><span class="ansi-red-
fg"> </span>BASH_CHAR_SET<span class="ansi-blue-fg">:</span>Set<span
class="ansi-blue-fg">[</span>Any<span class="ansi-blue-fg">]</span>
<span class="ansi-blue-fg">=</span> alphanumeric_char_set<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span
class="ansi-blue-fg">|</span> set<span class="ansi-blue-
fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-
fg">&#39;-&#39;</span><span class="ansi-blue-fg">,</span><span
class="ansi-blue-fg">&#39;+&#39;</span><span class="ansi-blue-
fg">,</span><span class="ansi-blue-fg">&#39;,&#39;</span><span
class="ansi-blue-fg">,</span><span class="ansi-blue-
fg">&#39;.&#39;</span><span class="ansi-blue-fg">]</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     20</span>
<span class="ansi-green-intense-fg ansi-bold">     21</span> <span
class="ansi-green-fg">def</span> non_alphanumeric_chars<span
class="ansi-blue-fg">(</span>filepath<span class="ansi-blue-
fg">:</span>str<span class="ansi-blue-fg">)</span><span class="ansi-
blue-fg">-&gt;</span>Set<span class="ansi-blue-fg">[</span>str<span
class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">~/.local/lib/python3.6/site-
packages/official/nlp/transformer/utils/tokenizer.py</span> in <span
class="ansi-cyan-fg">alphanumeric_char_set</span><span class="ansi-
blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span> <span
class="ansi-green-fg">def</span> alphanumeric_char_set<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>   return
set(
<span class="ansi-green-fg">---&gt; 50</span><span class="ansi-red-
fg">     </span>six<span class="ansi-blue-fg">.</span>unichr<span
class="ansi-blue-fg">(</span>i<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">for</span> i <span class="ansi-green-
fg">in</span> xrange<span class="ansi-blue-fg">(</span>sys<span
class="ansi-blue-fg">.</span>maxunicode<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>     if
(unicodedata.category(six.unichr(i)).startswith(&#34;L&#34;) or
<span class="ansi-green-intense-fg ansi-bold">     52</span>
unicodedata.category(six.unichr(i)).startswith(&#34;N&#34;)))
<span class="ansi-green-fg">~/.local/lib/python3.6/site-
packages/official/nlp/transformer/utils/tokenizer.py</span> in <span
class="ansi-cyan-fg">&lt;genexpr&gt;</span><span class="ansi-blue-
fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">     50</span>
six<span class="ansi-blue-fg">.</span>unichr<span class="ansi-blue-
fg">(</span>i<span class="ansi-blue-fg">)</span> <span class="ansi-
green-fg">for</span> i <span class="ansi-green-fg">in</span>
xrange<span class="ansi-blue-fg">(</span>sys<span class="ansi-blue-
fg">.</span>maxunicode<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>     if
(unicodedata.category(six.unichr(i)).startswith(&#34;L&#34;) or
<span class="ansi-green-fg">---&gt; 52</span><span class="ansi-red-
fg">
unicodedata.category(six.unichr(i)).startswith(&#34;N&#34;)))
</span><span class="ansi-green-intense-fg ansi-bold">     53</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span> <span
class="ansi-red-fg"># Set contains all letter and number
characters.</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div>

<h3>Model size</h3>
<p>The size of the model is not saved as a specieal part of the model output, but
we have defined a small function which reads it via Keras API.</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">analyze</span> <span class="kn">import</span> <span class="n">model_size</span>
</pre></div>

<p>The number of trainable weights of baseline model is
---------------------------------------------------------------------------NameError                                 Traceback (most recent call last)<ipython-input-1-1a49f203f0af> in <module>
----&gt; 1 model_size(baseline_transformer)
NameError: name 'baseline_transformer' is not defined parameters.</p>
<h3>Evaluation</h3>
<p>We now display the BLEU metrics of the model during first 6 training epoches.</p>

<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Training steps&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;BLEU-cased, Baseline transformer&quot;</span><span class="p">)</span>

<span class="n">out</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;STAGEDML_ROOT&#39;</span><span class="p">],</span><span class="s1">&#39;_experiments&#39;</span><span class="p">,</span><span class="s1">&#39;nl2bash&#39;</span><span class="p">,</span><span class="s1">&#39;baseline&#39;</span><span class="p">)</span>
<span class="n">makedirs</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">rref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">realizeMany</span><span class="p">(</span><span class="n">instantiate</span><span class="p">(</span><span class="n">baseline_transformer</span><span class="p">))):</span>
  <span class="n">mksymlink</span><span class="p">(</span><span class="n">rref</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;run-{i}&#39;</span><span class="p">,</span> <span class="n">withtime</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">baseline_bleu</span><span class="o">=</span><span class="n">read_tensorflow_log</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">rref2path</span><span class="p">(</span><span class="n">rref</span><span class="p">),</span><span class="s1">&#39;eval&#39;</span><span class="p">),</span> <span class="s1">&#39;bleu_cased&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">baseline_bleu</span><span class="p">)),</span> <span class="n">baseline_bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;run-{i}&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
Error in callback &lt;function flush_figures at 0x7ffb24097a60&gt;
(for post_execute):
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">NameError</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-b72b9453f9f4&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> out<span
class="ansi-blue-fg">=</span>join<span class="ansi-blue-
fg">(</span>environ<span class="ansi-blue-fg">[</span><span
class="ansi-blue-fg">&#39;STAGEDML_ROOT&#39;</span><span class="ansi-
blue-fg">]</span><span class="ansi-blue-fg">,</span><span class="ansi-
blue-fg">&#39;_experiments&#39;</span><span class="ansi-blue-
fg">,</span><span class="ansi-blue-fg">&#39;nl2bash&#39;</span><span
class="ansi-blue-fg">,</span><span class="ansi-blue-
fg">&#39;baseline&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>
makedirs<span class="ansi-blue-fg">(</span>out<span class="ansi-blue-
fg">,</span> exist_ok<span class="ansi-blue-fg">=</span><span
class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-
fg"> </span><span class="ansi-green-fg">for</span> i<span class="ansi-
blue-fg">,</span>rref <span class="ansi-green-fg">in</span>
enumerate<span class="ansi-blue-fg">(</span>realizeMany<span
class="ansi-blue-fg">(</span>instantiate<span class="ansi-blue-
fg">(</span>baseline_transformer<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>
mksymlink<span class="ansi-blue-fg">(</span>rref<span class="ansi-
blue-fg">,</span> out<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">f&#39;run-{i}&#39;</span><span class="ansi-blue-
fg">,</span> withtime<span class="ansi-blue-fg">=</span><span
class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>
baseline_bleu<span class="ansi-blue-
fg">=</span>read_tensorflow_log<span class="ansi-blue-
fg">(</span>join<span class="ansi-blue-fg">(</span>rref2path<span
class="ansi-blue-fg">(</span>rref<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-
fg">&#39;eval&#39;</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">&#39;bleu_cased&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">NameError</span>: name
&#39;baseline_transformer&#39; is not defined
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">KeyboardInterrupt</span>
Traceback (most recent call last)<span class="ansi-green-
fg">/usr/local/lib/python3.6/dist-
packages/ipykernel/pylab/backend_inline.py</span> in <span
class="ansi-cyan-fg">flush_figures</span><span class="ansi-blue-
fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>
<span class="ansi-red-fg"># ignore the tracking, just draw and close
all figures</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>
<span class="ansi-green-fg">try</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
show<span class="ansi-blue-fg">(</span><span class="ansi-green-
fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>
<span class="ansi-green-fg">except</span> Exception <span class="ansi-
green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>
<span class="ansi-red-fg"># safely show traceback if in IPython, else
raise</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/ipykernel/pylab/backend_inline.py</span> in <span
class="ansi-cyan-fg">show</span><span class="ansi-blue-fg">(close,
block)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
display(
<span class="ansi-green-intense-fg ansi-bold">     38</span>
figure_manager<span class="ansi-blue-fg">.</span>canvas<span
class="ansi-blue-fg">.</span>figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">---&gt; 39</span><span class="ansi-red-
fg">                 </span>metadata<span class="ansi-blue-
fg">=</span>_fetch_figure_metadata<span class="ansi-blue-
fg">(</span>figure_manager<span class="ansi-blue-
fg">.</span>canvas<span class="ansi-blue-fg">.</span>figure<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
)
<span class="ansi-green-intense-fg ansi-bold">     41</span>     <span
class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/display.py</span> in <span class="ansi-cyan-
fg">display</span><span class="ansi-blue-fg">(include, exclude,
metadata, transient, display_id, *objs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    304</span>
publish_display_data<span class="ansi-blue-fg">(</span>data<span
class="ansi-blue-fg">=</span>obj<span class="ansi-blue-fg">,</span>
metadata<span class="ansi-blue-fg">=</span>metadata<span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    305</span>
<span class="ansi-green-fg">else</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 306</span><span class="ansi-red-
fg">             </span>format_dict<span class="ansi-blue-fg">,</span>
md_dict <span class="ansi-blue-fg">=</span> format<span class="ansi-
blue-fg">(</span>obj<span class="ansi-blue-fg">,</span> include<span
class="ansi-blue-fg">=</span>include<span class="ansi-blue-
fg">,</span> exclude<span class="ansi-blue-fg">=</span>exclude<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    307</span>
<span class="ansi-green-fg">if</span> <span class="ansi-green-
fg">not</span> format_dict<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    308</span>
<span class="ansi-red-fg"># nothing to display (e.g. _ipython_display_
took over)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">format</span><span class="ansi-blue-fg">(self, obj, include,
exclude)</span>
<span class="ansi-green-intense-fg ansi-bold">    178</span>
md <span class="ansi-blue-fg">=</span> <span class="ansi-green-
fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    179</span>
<span class="ansi-green-fg">try</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 180</span><span class="ansi-red-
fg">                 </span>data <span class="ansi-blue-fg">=</span>
formatter<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    181</span>
<span class="ansi-green-fg">except</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    182</span>
<span class="ansi-red-fg"># FIXME: log the exception</span>
<span class="ansi-green-fg">&lt;/usr/local/lib/python3.6/dist-
packages/decorator.py:decorator-gen-10&gt;</span> in <span
class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self,
obj)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">catch_format_error</span><span class="ansi-blue-fg">(method, self,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    222</span>     <span
class="ansi-blue-fg">&#34;&#34;&#34;show traceback on failed format
call&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    223</span>     <span
class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 224</span><span class="ansi-red-
fg">         </span>r <span class="ansi-blue-fg">=</span> method<span
class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">*</span>args<span class="ansi-blue-
fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    225</span>     <span
class="ansi-green-fg">except</span> NotImplementedError<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    226</span>
<span class="ansi-red-fg"># don&#39;t warn on
NotImplementedErrors</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">__call__</span><span class="ansi-blue-fg">(self, obj)</span>
<span class="ansi-green-intense-fg ansi-bold">    339</span>
<span class="ansi-green-fg">pass</span>
<span class="ansi-green-intense-fg ansi-bold">    340</span>
<span class="ansi-green-fg">else</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 341</span><span class="ansi-red-
fg">                 </span><span class="ansi-green-fg">return</span>
printer<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    342</span>
<span class="ansi-red-fg"># Finally look for special method
names</span>
<span class="ansi-green-intense-fg ansi-bold">    343</span>
method <span class="ansi-blue-fg">=</span> get_real_method<span
class="ansi-blue-fg">(</span>obj<span class="ansi-blue-fg">,</span>
self<span class="ansi-blue-fg">.</span>print_method<span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/pylabtools.py</span> in <span class="ansi-cyan-
fg">&lt;lambda&gt;</span><span class="ansi-blue-fg">(fig)</span>
<span class="ansi-green-intense-fg ansi-bold">    248</span>
jpg_formatter<span class="ansi-blue-fg">.</span>for_type<span
class="ansi-blue-fg">(</span>Figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">lambda</span> fig<span class="ansi-blue-
fg">:</span> print_figure<span class="ansi-blue-fg">(</span>fig<span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">&#39;jpg&#39;</span><span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    249</span>     <span
class="ansi-green-fg">if</span> <span class="ansi-blue-
fg">&#39;svg&#39;</span> <span class="ansi-green-fg">in</span>
formats<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 250</span><span class="ansi-red-
fg">         </span>svg_formatter<span class="ansi-blue-
fg">.</span>for_type<span class="ansi-blue-fg">(</span>Figure<span
class="ansi-blue-fg">,</span> <span class="ansi-green-
fg">lambda</span> fig<span class="ansi-blue-fg">:</span>
print_figure<span class="ansi-blue-fg">(</span>fig<span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">&#39;svg&#39;</span><span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    251</span>     <span
class="ansi-green-fg">if</span> <span class="ansi-blue-
fg">&#39;pdf&#39;</span> <span class="ansi-green-fg">in</span>
formats<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    252</span>
pdf_formatter<span class="ansi-blue-fg">.</span>for_type<span
class="ansi-blue-fg">(</span>Figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">lambda</span> fig<span class="ansi-blue-
fg">:</span> print_figure<span class="ansi-blue-fg">(</span>fig<span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">&#39;pdf&#39;</span><span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/pylabtools.py</span> in <span class="ansi-cyan-
fg">print_figure</span><span class="ansi-blue-fg">(fig, fmt,
bbox_inches, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    126</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>
bytes_io <span class="ansi-blue-fg">=</span> BytesIO<span class="ansi-
blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 128</span><span class="ansi-red-
fg">     </span>fig<span class="ansi-blue-fg">.</span>canvas<span
class="ansi-blue-fg">.</span>print_figure<span class="ansi-blue-
fg">(</span>bytes_io<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    129</span>     data
<span class="ansi-blue-fg">=</span> bytes_io<span class="ansi-blue-
fg">.</span>getvalue<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span>     <span
class="ansi-green-fg">if</span> fmt <span class="ansi-blue-
fg">==</span> <span class="ansi-blue-fg">&#39;svg&#39;</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backend_bases.py</span> in <span class="ansi-cyan-
fg">print_figure</span><span class="ansi-blue-fg">(self, filename,
dpi, facecolor, edgecolor, orientation, format, bbox_inches,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   2054</span>
orientation<span class="ansi-blue-fg">=</span>orientation<span
class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2055</span>
dryrun<span class="ansi-blue-fg">=</span><span class="ansi-green-
fg">True</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">-&gt; 2056</span><span class="ansi-red-
fg">                         **kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">   2057</span>
renderer <span class="ansi-blue-fg">=</span> self<span class="ansi-
blue-fg">.</span>figure<span class="ansi-blue-
fg">.</span>_cachedRenderer
<span class="ansi-green-intense-fg ansi-bold">   2058</span>
bbox_artists <span class="ansi-blue-fg">=</span> kwargs<span
class="ansi-blue-fg">.</span>pop<span class="ansi-blue-
fg">(</span><span class="ansi-blue-
fg">&#34;bbox_extra_artists&#34;</span><span class="ansi-blue-
fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backends/backend_svg.py</span> in <span
class="ansi-cyan-fg">print_svg</span><span class="ansi-blue-fg">(self,
filename, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1200</span>
detach <span class="ansi-blue-fg">=</span> <span class="ansi-green-
fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">   1201</span>
<span class="ansi-green-fg">-&gt; 1202</span><span class="ansi-red-
fg">             </span>result <span class="ansi-blue-fg">=</span>
self<span class="ansi-blue-fg">.</span>_print_svg<span class="ansi-
blue-fg">(</span>filename<span class="ansi-blue-fg">,</span> fh<span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1203</span>
<span class="ansi-green-intense-fg ansi-bold">   1204</span>
<span class="ansi-red-fg"># Detach underlying stream from wrapper so
that it remains open in</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backends/backend_svg.py</span> in <span
class="ansi-cyan-fg">_print_svg</span><span class="ansi-blue-
fg">(self, filename, fh, dpi, bbox_inches_restore, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1225</span>
bbox_inches_restore=bbox_inches_restore)
<span class="ansi-green-intense-fg ansi-bold">   1226</span>
<span class="ansi-green-fg">-&gt; 1227</span><span class="ansi-red-
fg">         </span>self<span class="ansi-blue-fg">.</span>figure<span
class="ansi-blue-fg">.</span>draw<span class="ansi-blue-
fg">(</span>renderer<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1228</span>
renderer<span class="ansi-blue-fg">.</span>finalize<span class="ansi-
blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1229</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/artist.py</span> in <span class="ansi-cyan-
fg">draw_wrapper</span><span class="ansi-blue-fg">(artist, renderer,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>
renderer<span class="ansi-blue-fg">.</span>start_filter<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
<span class="ansi-green-fg">---&gt; 38</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
draw<span class="ansi-blue-fg">(</span>artist<span class="ansi-blue-
fg">,</span> renderer<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span>
<span class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
<span class="ansi-green-fg">if</span> artist<span class="ansi-blue-
fg">.</span>get_agg_filter<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span> <span class="ansi-green-fg">is</span>
<span class="ansi-green-fg">not</span> <span class="ansi-green-
fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/figure.py</span> in <span class="ansi-cyan-
fg">draw</span><span class="ansi-blue-fg">(self, renderer)</span>
<span class="ansi-green-intense-fg ansi-bold">   1707</span>
self<span class="ansi-blue-fg">.</span>patch<span class="ansi-blue-
fg">.</span>draw<span class="ansi-blue-fg">(</span>renderer<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1708</span>
mimage._draw_list_compositing_images(
<span class="ansi-green-fg">-&gt; 1709</span><span class="ansi-red-
fg">                 renderer, self, artists, self.suppressComposite)
</span><span class="ansi-green-intense-fg ansi-bold">   1710</span>
<span class="ansi-green-intense-fg ansi-bold">   1711</span>
renderer<span class="ansi-blue-fg">.</span>close_group<span
class="ansi-blue-fg">(</span><span class="ansi-blue-
fg">&#39;figure&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/image.py</span> in <span class="ansi-cyan-
fg">_draw_list_compositing_images</span><span class="ansi-blue-
fg">(renderer, parent, artists, suppress_composite)</span>
<span class="ansi-green-intense-fg ansi-bold">    133</span>     <span
class="ansi-green-fg">if</span> not_composite <span class="ansi-green-
fg">or</span> <span class="ansi-green-fg">not</span> has_images<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>
<span class="ansi-green-fg">for</span> a <span class="ansi-green-
fg">in</span> artists<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 135</span><span class="ansi-red-
fg">             </span>a<span class="ansi-blue-fg">.</span>draw<span
class="ansi-blue-fg">(</span>renderer<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    136</span>     <span
class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    137</span>
<span class="ansi-red-fg"># Composite any adjacent images
together</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/artist.py</span> in <span class="ansi-cyan-
fg">draw_wrapper</span><span class="ansi-blue-fg">(artist, renderer,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>
renderer<span class="ansi-blue-fg">.</span>start_filter<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
<span class="ansi-green-fg">---&gt; 38</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
draw<span class="ansi-blue-fg">(</span>artist<span class="ansi-blue-
fg">,</span> renderer<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span>
<span class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
<span class="ansi-green-fg">if</span> artist<span class="ansi-blue-
fg">.</span>get_agg_filter<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span> <span class="ansi-green-fg">is</span>
<span class="ansi-green-fg">not</span> <span class="ansi-green-
fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/axes/_base.py</span> in <span class="ansi-cyan-
fg">draw</span><span class="ansi-blue-fg">(self, renderer,
inframe)</span>
<span class="ansi-green-intense-fg ansi-bold">   2645</span>
renderer<span class="ansi-blue-fg">.</span>stop_rasterizing<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2646</span>
<span class="ansi-green-fg">-&gt; 2647</span><span class="ansi-red-
fg">         </span>mimage<span class="ansi-blue-
fg">.</span>_draw_list_compositing_images<span class="ansi-blue-
fg">(</span>renderer<span class="ansi-blue-fg">,</span> self<span
class="ansi-blue-fg">,</span> artists<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2648</span>
<span class="ansi-green-intense-fg ansi-bold">   2649</span>
renderer<span class="ansi-blue-fg">.</span>close_group<span
class="ansi-blue-fg">(</span><span class="ansi-blue-
fg">&#39;axes&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/image.py</span> in <span class="ansi-cyan-
fg">_draw_list_compositing_images</span><span class="ansi-blue-
fg">(renderer, parent, artists, suppress_composite)</span>
<span class="ansi-green-intense-fg ansi-bold">    133</span>     <span
class="ansi-green-fg">if</span> not_composite <span class="ansi-green-
fg">or</span> <span class="ansi-green-fg">not</span> has_images<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>
<span class="ansi-green-fg">for</span> a <span class="ansi-green-
fg">in</span> artists<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 135</span><span class="ansi-red-
fg">             </span>a<span class="ansi-blue-fg">.</span>draw<span
class="ansi-blue-fg">(</span>renderer<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    136</span>     <span
class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    137</span>
<span class="ansi-red-fg"># Composite any adjacent images
together</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/artist.py</span> in <span class="ansi-cyan-
fg">draw_wrapper</span><span class="ansi-blue-fg">(artist, renderer,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>
renderer<span class="ansi-blue-fg">.</span>start_filter<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
<span class="ansi-green-fg">---&gt; 38</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
draw<span class="ansi-blue-fg">(</span>artist<span class="ansi-blue-
fg">,</span> renderer<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span>
<span class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
<span class="ansi-green-fg">if</span> artist<span class="ansi-blue-
fg">.</span>get_agg_filter<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span> <span class="ansi-green-fg">is</span>
<span class="ansi-green-fg">not</span> <span class="ansi-green-
fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/axis.py</span> in <span class="ansi-cyan-
fg">draw</span><span class="ansi-blue-fg">(self, renderer, *args,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1206</span>
<span class="ansi-green-intense-fg ansi-bold">   1207</span>
<span class="ansi-green-fg">for</span> tick <span class="ansi-green-
fg">in</span> ticks_to_draw<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1208</span><span class="ansi-red-
fg">             </span>tick<span class="ansi-blue-
fg">.</span>draw<span class="ansi-blue-fg">(</span>renderer<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1209</span>
<span class="ansi-green-intense-fg ansi-bold">   1210</span>
<span class="ansi-red-fg"># scale up the axis label box to also find
the neighbors, not</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/artist.py</span> in <span class="ansi-cyan-
fg">draw_wrapper</span><span class="ansi-blue-fg">(artist, renderer,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>
renderer<span class="ansi-blue-fg">.</span>start_filter<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
<span class="ansi-green-fg">---&gt; 38</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
draw<span class="ansi-blue-fg">(</span>artist<span class="ansi-blue-
fg">,</span> renderer<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span>
<span class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
<span class="ansi-green-fg">if</span> artist<span class="ansi-blue-
fg">.</span>get_agg_filter<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span> <span class="ansi-green-fg">is</span>
<span class="ansi-green-fg">not</span> <span class="ansi-green-
fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/axis.py</span> in <span class="ansi-cyan-
fg">draw</span><span class="ansi-blue-fg">(self, renderer)</span>
<span class="ansi-green-intense-fg ansi-bold">    295</span>
for artist in [self.gridline, self.tick1line, self.tick2line,
<span class="ansi-green-intense-fg ansi-bold">    296</span>
self.label1, self.label2]:
<span class="ansi-green-fg">--&gt; 297</span><span class="ansi-red-
fg">             </span>artist<span class="ansi-blue-
fg">.</span>draw<span class="ansi-blue-fg">(</span>renderer<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    298</span>
renderer<span class="ansi-blue-fg">.</span>close_group<span
class="ansi-blue-fg">(</span>self<span class="ansi-blue-
fg">.</span>__name__<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    299</span>
self<span class="ansi-blue-fg">.</span>stale <span class="ansi-blue-
fg">=</span> <span class="ansi-green-fg">False</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/artist.py</span> in <span class="ansi-cyan-
fg">draw_wrapper</span><span class="ansi-blue-fg">(artist, renderer,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>
renderer<span class="ansi-blue-fg">.</span>start_filter<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
<span class="ansi-green-fg">---&gt; 38</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
draw<span class="ansi-blue-fg">(</span>artist<span class="ansi-blue-
fg">,</span> renderer<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span>
<span class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
<span class="ansi-green-fg">if</span> artist<span class="ansi-blue-
fg">.</span>get_agg_filter<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span> <span class="ansi-green-fg">is</span>
<span class="ansi-green-fg">not</span> <span class="ansi-green-
fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/lines.py</span> in <span class="ansi-cyan-
fg">draw</span><span class="ansi-blue-fg">(self, renderer)</span>
<span class="ansi-green-intense-fg ansi-bold">    867</span>
renderer.draw_markers(gc, marker_path, marker_trans,
<span class="ansi-green-intense-fg ansi-bold">    868</span>
subsampled<span class="ansi-blue-fg">,</span> affine<span class="ansi-
blue-fg">.</span>frozen<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 869</span><span class="ansi-red-
fg">                                       fc_rgba)
</span><span class="ansi-green-intense-fg ansi-bold">    870</span>
<span class="ansi-green-intense-fg ansi-bold">    871</span>
alt_marker_path <span class="ansi-blue-fg">=</span> marker<span
class="ansi-blue-fg">.</span>get_alt_path<span class="ansi-blue-
fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backends/backend_svg.py</span> in <span
class="ansi-cyan-fg">draw_markers</span><span class="ansi-blue-
fg">(self, gc, marker_path, marker_trans, path, trans, rgbFace)</span>
<span class="ansi-green-intense-fg ansi-bold">    562</span>
marker_trans <span class="ansi-blue-fg">+</span> Affine2D<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">.</span>scale<span class="ansi-blue-
fg">(</span><span class="ansi-cyan-fg">1.0</span><span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">-</span><span
class="ansi-cyan-fg">1.0</span><span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    563</span>
simplify=False)
<span class="ansi-green-fg">--&gt; 564</span><span class="ansi-red-
fg">         </span>style <span class="ansi-blue-fg">=</span>
self<span class="ansi-blue-fg">.</span>_get_style_dict<span
class="ansi-blue-fg">(</span>gc<span class="ansi-blue-fg">,</span>
rgbFace<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    565</span>
dictkey <span class="ansi-blue-fg">=</span> <span class="ansi-blue-
fg">(</span>path_data<span class="ansi-blue-fg">,</span>
generate_css<span class="ansi-blue-fg">(</span>style<span class="ansi-
blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    566</span>
oid <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-
fg">.</span>_markers<span class="ansi-blue-fg">.</span>get<span
class="ansi-blue-fg">(</span>dictkey<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backends/backend_svg.py</span> in <span
class="ansi-cyan-fg">_get_style_dict</span><span class="ansi-blue-
fg">(self, gc, rgbFace)</span>
<span class="ansi-green-intense-fg ansi-bold">    445</span>
<span class="ansi-green-fg">if</span> linewidth <span class="ansi-
blue-fg">!=</span> <span class="ansi-cyan-fg">1.0</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    446</span>
attrib<span class="ansi-blue-fg">[</span><span class="ansi-blue-
fg">&#39;stroke-width&#39;</span><span class="ansi-blue-fg">]</span>
<span class="ansi-blue-fg">=</span> short_float_fmt<span class="ansi-
blue-fg">(</span>linewidth<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 447</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">if</span> gc<span
class="ansi-blue-fg">.</span>get_joinstyle<span class="ansi-blue-
fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-
blue-fg">!=</span> <span class="ansi-blue-
fg">&#39;round&#39;</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    448</span>
attrib<span class="ansi-blue-fg">[</span><span class="ansi-blue-
fg">&#39;stroke-linejoin&#39;</span><span class="ansi-blue-
fg">]</span> <span class="ansi-blue-fg">=</span> gc<span class="ansi-
blue-fg">.</span>get_joinstyle<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    449</span>
<span class="ansi-green-fg">if</span> gc<span class="ansi-blue-
fg">.</span>get_capstyle<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">!=</span>
<span class="ansi-blue-fg">&#39;butt&#39;</span><span class="ansi-
blue-fg">:</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div>

<h2>Unshuffled dataset</h2>
<p>This experiment</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">unshuffled_subtok</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">all_nl2bashsubtok</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                              <span class="n">with_bash_charset</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                              <span class="n">with_bash_subtokens</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">unshuffled_transformer</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;train_steps&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="mi">5000</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;beam_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">3</span> <span class="c1"># As in Tellina paper</span>
    <span class="k">return</span> <span class="n">mkconfig</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">redefine</span><span class="p">(</span><span class="n">transformer_wmt</span><span class="p">,</span><span class="n">_config</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="n">unshuffled_subtok</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</pre></div>

<p>Results:</p>

<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Training steps&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;BLEU, Unshuffled transformer&quot;</span><span class="p">)</span>

<span class="n">out</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;STAGEDML_ROOT&#39;</span><span class="p">],</span><span class="s1">&#39;_experiments&#39;</span><span class="p">,</span><span class="s1">&#39;nl2bash&#39;</span><span class="p">,</span><span class="s1">&#39;unshuffled&#39;</span><span class="p">)</span>
<span class="n">makedirs</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">rref</span><span class="o">=</span><span class="n">realize</span><span class="p">(</span><span class="n">instantiate</span><span class="p">(</span><span class="n">unshuffled_transformer</span><span class="p">))</span>
<span class="n">mksymlink</span><span class="p">(</span><span class="n">rref</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">withtime</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">unshuffled_bleu</span><span class="o">=</span><span class="n">read_tensorflow_log</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">rref2path</span><span class="p">(</span><span class="n">rref</span><span class="p">),</span><span class="s1">&#39;eval&#39;</span><span class="p">),</span> <span class="s1">&#39;bleu_cased&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unshuffled_bleu</span><span class="p">)),</span> <span class="n">unshuffled_bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
Error in callback &lt;function flush_figures at 0x7ffb24097a60&gt;
(for post_execute):
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">NameError</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-03b36625dca1&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> out<span
class="ansi-blue-fg">=</span>join<span class="ansi-blue-
fg">(</span>environ<span class="ansi-blue-fg">[</span><span
class="ansi-blue-fg">&#39;STAGEDML_ROOT&#39;</span><span class="ansi-
blue-fg">]</span><span class="ansi-blue-fg">,</span><span class="ansi-
blue-fg">&#39;_experiments&#39;</span><span class="ansi-blue-
fg">,</span><span class="ansi-blue-fg">&#39;nl2bash&#39;</span><span
class="ansi-blue-fg">,</span><span class="ansi-blue-
fg">&#39;unshuffled&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>
makedirs<span class="ansi-blue-fg">(</span>out<span class="ansi-blue-
fg">,</span> exist_ok<span class="ansi-blue-fg">=</span><span
class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-
fg"> </span>rref<span class="ansi-blue-fg">=</span>realize<span
class="ansi-blue-fg">(</span>instantiate<span class="ansi-blue-
fg">(</span>unshuffled_transformer<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>
mksymlink<span class="ansi-blue-fg">(</span>rref<span class="ansi-
blue-fg">,</span> out<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">&#39;result&#39;</span><span class="ansi-blue-
fg">,</span> withtime<span class="ansi-blue-fg">=</span><span
class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>
unshuffled_bleu<span class="ansi-blue-
fg">=</span>read_tensorflow_log<span class="ansi-blue-
fg">(</span>join<span class="ansi-blue-fg">(</span>rref2path<span
class="ansi-blue-fg">(</span>rref<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-
fg">&#39;eval&#39;</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">&#39;bleu_cased&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/pylightnix/core.py</span> in <span class="ansi-cyan-
fg">instantiate</span><span class="ansi-blue-fg">(stage, *args,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    723</span>   See
also [realizeMany](#pylightnix.core.realizeMany)
<span class="ansi-green-intense-fg ansi-bold">    724</span>
&#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 725</span><span class="ansi-red-
fg">   </span><span class="ansi-green-fg">return</span>
instantiate_<span class="ansi-blue-fg">(</span>Manager<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">,</span> stage<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">*</span>args<span class="ansi-blue-
fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    726</span>
<span class="ansi-green-intense-fg ansi-bold">    727</span>
RealizeSeqGen <span class="ansi-blue-fg">=</span> Generator<span
class="ansi-blue-fg">[</span>Tuple<span class="ansi-blue-
fg">[</span>DRef<span class="ansi-blue-fg">,</span>Context<span
class="ansi-blue-fg">,</span>Derivation<span class="ansi-blue-
fg">,</span>RealizeArg<span class="ansi-blue-fg">]</span><span
class="ansi-blue-fg">,</span>Tuple<span class="ansi-blue-
fg">[</span>Optional<span class="ansi-blue-fg">[</span>List<span
class="ansi-blue-fg">[</span>RRef<span class="ansi-blue-
fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-
fg">,</span>bool<span class="ansi-blue-fg">]</span><span class="ansi-
blue-fg">,</span>List<span class="ansi-blue-fg">[</span>RRef<span
class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/pylightnix/core.py</span> in <span class="ansi-cyan-
fg">instantiate_</span><span class="ansi-blue-fg">(m, stage, *args,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    712</span> <span
class="ansi-green-fg">def</span> instantiate_<span class="ansi-blue-
fg">(</span>m<span class="ansi-blue-fg">:</span>Manager<span
class="ansi-blue-fg">,</span> stage<span class="ansi-blue-
fg">:</span>Any<span class="ansi-blue-fg">,</span> <span class="ansi-
blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">-&gt;</span>Closure<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    713</span>   <span
class="ansi-green-fg">with</span> recursion_manager<span class="ansi-
blue-fg">(</span><span class="ansi-blue-
fg">&#39;instantiate&#39;</span><span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 714</span><span class="ansi-red-
fg">     </span>target_dref<span class="ansi-blue-
fg">=</span>stage<span class="ansi-blue-fg">(</span>m<span
class="ansi-blue-fg">,</span><span class="ansi-blue-
fg">*</span>args<span class="ansi-blue-fg">,</span><span class="ansi-
blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    715</span>
assert_have_realizers<span class="ansi-blue-fg">(</span>m<span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">[</span>target_dref<span class="ansi-blue-fg">]</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    716</span>     <span
class="ansi-green-fg">return</span> Closure<span class="ansi-blue-
fg">(</span>target_dref<span class="ansi-blue-fg">,</span>list<span
class="ansi-blue-fg">(</span>m<span class="ansi-blue-
fg">.</span>builders<span class="ansi-blue-fg">.</span>values<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">&lt;ipython-
input-1-e42d31dc4783&gt;</span> in <span class="ansi-cyan-
fg">unshuffled_transformer</span><span class="ansi-blue-fg">(m)</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>
c<span class="ansi-blue-fg">[</span><span class="ansi-blue-
fg">&#39;params&#39;</span><span class="ansi-blue-fg">]</span><span
class="ansi-blue-fg">[</span><span class="ansi-blue-
fg">&#39;beam_size&#39;</span><span class="ansi-blue-fg">]</span><span
class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span> <span
class="ansi-red-fg"># As in Tellina paper</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span>     <span
class="ansi-green-fg">return</span> mkconfig<span class="ansi-blue-
fg">(</span>c<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 11</span><span class="ansi-red-
fg">   </span><span class="ansi-green-fg">return</span> redefine<span
class="ansi-blue-fg">(</span>transformer_wmt<span class="ansi-blue-
fg">,</span>_config<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">(</span>m<span class="ansi-blue-fg">,</span>
unshuffled_subtok<span class="ansi-blue-fg">(</span>m<span
class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">NameError</span>: name
&#39;transformer_wmt&#39; is not defined
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">KeyboardInterrupt</span>
Traceback (most recent call last)<span class="ansi-green-
fg">/usr/local/lib/python3.6/dist-
packages/ipykernel/pylab/backend_inline.py</span> in <span
class="ansi-cyan-fg">flush_figures</span><span class="ansi-blue-
fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>
<span class="ansi-red-fg"># ignore the tracking, just draw and close
all figures</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>
<span class="ansi-green-fg">try</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
show<span class="ansi-blue-fg">(</span><span class="ansi-green-
fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>
<span class="ansi-green-fg">except</span> Exception <span class="ansi-
green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>
<span class="ansi-red-fg"># safely show traceback if in IPython, else
raise</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/ipykernel/pylab/backend_inline.py</span> in <span
class="ansi-cyan-fg">show</span><span class="ansi-blue-fg">(close,
block)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
display(
<span class="ansi-green-intense-fg ansi-bold">     38</span>
figure_manager<span class="ansi-blue-fg">.</span>canvas<span
class="ansi-blue-fg">.</span>figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">---&gt; 39</span><span class="ansi-red-
fg">                 </span>metadata<span class="ansi-blue-
fg">=</span>_fetch_figure_metadata<span class="ansi-blue-
fg">(</span>figure_manager<span class="ansi-blue-
fg">.</span>canvas<span class="ansi-blue-fg">.</span>figure<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
)
<span class="ansi-green-intense-fg ansi-bold">     41</span>     <span
class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/display.py</span> in <span class="ansi-cyan-
fg">display</span><span class="ansi-blue-fg">(include, exclude,
metadata, transient, display_id, *objs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    304</span>
publish_display_data<span class="ansi-blue-fg">(</span>data<span
class="ansi-blue-fg">=</span>obj<span class="ansi-blue-fg">,</span>
metadata<span class="ansi-blue-fg">=</span>metadata<span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    305</span>
<span class="ansi-green-fg">else</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 306</span><span class="ansi-red-
fg">             </span>format_dict<span class="ansi-blue-fg">,</span>
md_dict <span class="ansi-blue-fg">=</span> format<span class="ansi-
blue-fg">(</span>obj<span class="ansi-blue-fg">,</span> include<span
class="ansi-blue-fg">=</span>include<span class="ansi-blue-
fg">,</span> exclude<span class="ansi-blue-fg">=</span>exclude<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    307</span>
<span class="ansi-green-fg">if</span> <span class="ansi-green-
fg">not</span> format_dict<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    308</span>
<span class="ansi-red-fg"># nothing to display (e.g. _ipython_display_
took over)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">format</span><span class="ansi-blue-fg">(self, obj, include,
exclude)</span>
<span class="ansi-green-intense-fg ansi-bold">    178</span>
md <span class="ansi-blue-fg">=</span> <span class="ansi-green-
fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    179</span>
<span class="ansi-green-fg">try</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 180</span><span class="ansi-red-
fg">                 </span>data <span class="ansi-blue-fg">=</span>
formatter<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    181</span>
<span class="ansi-green-fg">except</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    182</span>
<span class="ansi-red-fg"># FIXME: log the exception</span>
<span class="ansi-green-fg">&lt;/usr/local/lib/python3.6/dist-
packages/decorator.py:decorator-gen-10&gt;</span> in <span
class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self,
obj)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">catch_format_error</span><span class="ansi-blue-fg">(method, self,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    222</span>     <span
class="ansi-blue-fg">&#34;&#34;&#34;show traceback on failed format
call&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    223</span>     <span
class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 224</span><span class="ansi-red-
fg">         </span>r <span class="ansi-blue-fg">=</span> method<span
class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">*</span>args<span class="ansi-blue-
fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    225</span>     <span
class="ansi-green-fg">except</span> NotImplementedError<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    226</span>
<span class="ansi-red-fg"># don&#39;t warn on
NotImplementedErrors</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">__call__</span><span class="ansi-blue-fg">(self, obj)</span>
<span class="ansi-green-intense-fg ansi-bold">    339</span>
<span class="ansi-green-fg">pass</span>
<span class="ansi-green-intense-fg ansi-bold">    340</span>
<span class="ansi-green-fg">else</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 341</span><span class="ansi-red-
fg">                 </span><span class="ansi-green-fg">return</span>
printer<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    342</span>
<span class="ansi-red-fg"># Finally look for special method
names</span>
<span class="ansi-green-intense-fg ansi-bold">    343</span>
method <span class="ansi-blue-fg">=</span> get_real_method<span
class="ansi-blue-fg">(</span>obj<span class="ansi-blue-fg">,</span>
self<span class="ansi-blue-fg">.</span>print_method<span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/pylabtools.py</span> in <span class="ansi-cyan-
fg">&lt;lambda&gt;</span><span class="ansi-blue-fg">(fig)</span>
<span class="ansi-green-intense-fg ansi-bold">    242</span>
<span class="ansi-green-intense-fg ansi-bold">    243</span>     <span
class="ansi-green-fg">if</span> <span class="ansi-blue-
fg">&#39;png&#39;</span> <span class="ansi-green-fg">in</span>
formats<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 244</span><span class="ansi-red-
fg">         </span>png_formatter<span class="ansi-blue-
fg">.</span>for_type<span class="ansi-blue-fg">(</span>Figure<span
class="ansi-blue-fg">,</span> <span class="ansi-green-
fg">lambda</span> fig<span class="ansi-blue-fg">:</span>
print_figure<span class="ansi-blue-fg">(</span>fig<span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">&#39;png&#39;</span><span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    245</span>     <span
class="ansi-green-fg">if</span> <span class="ansi-blue-
fg">&#39;retina&#39;</span> <span class="ansi-green-fg">in</span>
formats <span class="ansi-green-fg">or</span> <span class="ansi-blue-
fg">&#39;png2x&#39;</span> <span class="ansi-green-fg">in</span>
formats<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    246</span>
png_formatter<span class="ansi-blue-fg">.</span>for_type<span
class="ansi-blue-fg">(</span>Figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">lambda</span> fig<span class="ansi-blue-
fg">:</span> retina_figure<span class="ansi-blue-fg">(</span>fig<span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/pylabtools.py</span> in <span class="ansi-cyan-
fg">print_figure</span><span class="ansi-blue-fg">(fig, fmt,
bbox_inches, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    126</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>
bytes_io <span class="ansi-blue-fg">=</span> BytesIO<span class="ansi-
blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 128</span><span class="ansi-red-
fg">     </span>fig<span class="ansi-blue-fg">.</span>canvas<span
class="ansi-blue-fg">.</span>print_figure<span class="ansi-blue-
fg">(</span>bytes_io<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    129</span>     data
<span class="ansi-blue-fg">=</span> bytes_io<span class="ansi-blue-
fg">.</span>getvalue<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span>     <span
class="ansi-green-fg">if</span> fmt <span class="ansi-blue-
fg">==</span> <span class="ansi-blue-fg">&#39;svg&#39;</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backend_bases.py</span> in <span class="ansi-cyan-
fg">print_figure</span><span class="ansi-blue-fg">(self, filename,
dpi, facecolor, edgecolor, orientation, format, bbox_inches,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   2054</span>
orientation<span class="ansi-blue-fg">=</span>orientation<span
class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2055</span>
dryrun<span class="ansi-blue-fg">=</span><span class="ansi-green-
fg">True</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">-&gt; 2056</span><span class="ansi-red-
fg">                         **kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">   2057</span>
renderer <span class="ansi-blue-fg">=</span> self<span class="ansi-
blue-fg">.</span>figure<span class="ansi-blue-
fg">.</span>_cachedRenderer
<span class="ansi-green-intense-fg ansi-bold">   2058</span>
bbox_artists <span class="ansi-blue-fg">=</span> kwargs<span
class="ansi-blue-fg">.</span>pop<span class="ansi-blue-
fg">(</span><span class="ansi-blue-
fg">&#34;bbox_extra_artists&#34;</span><span class="ansi-blue-
fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backends/backend_agg.py</span> in <span
class="ansi-cyan-fg">print_png</span><span class="ansi-blue-fg">(self,
filename_or_obj, metadata, pil_kwargs, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    530</span>
cbook<span class="ansi-blue-fg">.</span>open_file_cm<span class="ansi-
blue-fg">(</span>filename_or_obj<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">&#34;wb&#34;</span><span class="ansi-blue-
fg">)</span> <span class="ansi-green-fg">as</span> fh<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    531</span>
_png.write_png(renderer._renderer, fh,
<span class="ansi-green-fg">--&gt; 532</span><span class="ansi-red-
fg">                                self.figure.dpi,
metadata=metadata)
</span><span class="ansi-green-intense-fg ansi-bold">    533</span>
<span class="ansi-green-intense-fg ansi-bold">    534</span>     <span
class="ansi-green-fg">def</span> print_to_buffer<span class="ansi-
blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div>

<h2>Bash-specific tokens</h2>
<p>Originally this experiment was intended to run the model with bash-specific
tokens <em>and</em> different vocabulary sizes. Unfortunately, due to subtokenizer API
misuse, we in face measure the performance of the model on the same target
vocabulary size of <code>8192</code> tokens. We will make the corrections in the next
experiment and here we display just the effect of adding bash-specific tokens.</p>
<p>Adding the bash-specifics include:</p>
<ol>
<li>Changing the Master Character Set of the Subtokenizer by adding
   <code>['-','+',',','.']</code> to the default list of Alphanumeric characters</li>
<li>Pre-parsing the train part of BASH dataset and generating the list of
   reserved subtokens. The list includes:<ul>
<li>First words of every command. Often those are command names.</li>
<li>All words starting from <code>-</code>. Often those are flags of bash commands.</li>
</ul>
</li>
</ol>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run1</span><span class="p">(</span><span class="n">vsize</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RRef</span><span class="p">:</span>

  <span class="k">def</span> <span class="nf">mysubtok</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
      <span class="n">d</span><span class="p">[</span><span class="s1">&#39;target_vocab_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vsize</span>
      <span class="n">d</span><span class="p">[</span><span class="s1">&#39;vocab_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">promise</span><span class="p">,</span> <span class="s1">&#39;vocab.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">vsize</span><span class="p">]</span>
      <span class="k">return</span> <span class="n">mkconfig</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redefine</span><span class="p">(</span><span class="n">all_nl2bashsubtok</span><span class="p">,</span> <span class="n">_config</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span>
                    <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_bash_charset</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_bash_subtokens</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">mytransformer</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
      <span class="n">c</span><span class="p">[</span><span class="s1">&#39;train_steps&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">5000</span>
      <span class="n">c</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;beam_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">3</span> <span class="c1"># As in Tellina paper</span>
      <span class="k">return</span> <span class="n">mkconfig</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redefine</span><span class="p">(</span><span class="n">transformer_wmt</span><span class="p">,</span><span class="n">_config</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="n">mysubtok</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>

  <span class="k">return</span> <span class="n">mysubtok</span><span class="p">,</span> <span class="n">mytransformer</span>
</pre></div>

<p>Results:</p>

<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Training steps&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;BLEU, Bash-specific tokens&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unshuffled_bleu</span><span class="p">)),</span> <span class="n">unshuffled_bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;Unshuffled transformer&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">baseline_bleu</span><span class="p">)),</span> <span class="n">baseline_bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;Baseline transformer&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="n">out</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;STAGEDML_ROOT&#39;</span><span class="p">],</span><span class="s1">&#39;_experiments&#39;</span><span class="p">,</span><span class="s1">&#39;nl2bash&#39;</span><span class="p">,</span><span class="s1">&#39;bashspec&#39;</span><span class="p">)</span>
<span class="n">makedirs</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">vsize</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">25000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span> <span class="p">])</span> <span class="p">:</span>
  <span class="n">mysubtok</span><span class="p">,</span><span class="n">mytransformer</span><span class="o">=</span><span class="n">run1</span><span class="p">(</span><span class="n">vsize</span><span class="p">)</span>
  <span class="n">rref</span><span class="o">=</span><span class="n">realize</span><span class="p">(</span><span class="n">instantiate</span><span class="p">(</span><span class="n">mytransformer</span><span class="p">))</span>
  <span class="n">mksymlink</span><span class="p">(</span><span class="n">rref</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;run-{i}&#39;</span><span class="p">,</span> <span class="n">withtime</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">bleu</span><span class="o">=</span><span class="n">read_tensorflow_log</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">rref2path</span><span class="p">(</span><span class="n">rref</span><span class="p">),</span><span class="s1">&#39;eval&#39;</span><span class="p">),</span> <span class="s1">&#39;bleu_cased&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bleu</span><span class="p">)),</span> <span class="n">bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;run-{i}&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">KeyboardInterrupt</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-1c323dbdfbe0&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> plt<span
class="ansi-blue-fg">.</span>figure<span class="ansi-blue-
fg">(</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-
fg">)</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-
fg"> </span>plt<span class="ansi-blue-fg">.</span>xlabel<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Training
steps&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> plt<span
class="ansi-blue-fg">.</span>title<span class="ansi-blue-
fg">(</span><span class="ansi-blue-fg">&#34;BLEU, Bash-specific
tokens&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> plt<span
class="ansi-blue-fg">.</span>plot<span class="ansi-blue-
fg">(</span>range<span class="ansi-blue-fg">(</span>len<span
class="ansi-blue-fg">(</span>unshuffled_bleu<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-
fg">,</span> unshuffled_bleu<span class="ansi-blue-fg">,</span>
label<span class="ansi-blue-fg">=</span><span class="ansi-blue-
fg">f&#39;Unshuffled transformer&#39;</span><span class="ansi-blue-
fg">,</span> color<span class="ansi-blue-fg">=</span><span
class="ansi-blue-fg">&#39;red&#39;</span><span class="ansi-blue-
fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/pyplot.py</span> in <span class="ansi-cyan-
fg">xlabel</span><span class="ansi-blue-fg">(xlabel, fontdict,
labelpad, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   3066</span> <span
class="ansi-blue-fg">@</span>docstring<span class="ansi-blue-
fg">.</span>copy<span class="ansi-blue-fg">(</span>Axes<span
class="ansi-blue-fg">.</span>set_xlabel<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3067</span> <span
class="ansi-green-fg">def</span> xlabel<span class="ansi-blue-
fg">(</span>xlabel<span class="ansi-blue-fg">,</span> fontdict<span
class="ansi-blue-fg">=</span><span class="ansi-green-
fg">None</span><span class="ansi-blue-fg">,</span> labelpad<span
class="ansi-blue-fg">=</span><span class="ansi-green-
fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-
blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 3068</span><span class="ansi-red-
fg">     return gca().set_xlabel(
</span><span class="ansi-green-intense-fg ansi-bold">   3069</span>
xlabel, fontdict=fontdict, labelpad=labelpad, **kwargs)
<span class="ansi-green-intense-fg ansi-bold">   3070</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/pyplot.py</span> in <span class="ansi-cyan-
fg">gca</span><span class="ansi-blue-fg">(**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    924</span>
matplotlib<span class="ansi-blue-fg">.</span>figure<span class="ansi-
blue-fg">.</span>Figure<span class="ansi-blue-fg">.</span>gca <span
class="ansi-blue-fg">:</span> The figure<span class="ansi-red-
fg">&#39;</span>s gca method<span class="ansi-blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">    925</span>
&#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 926</span><span class="ansi-red-
fg">     </span><span class="ansi-green-fg">return</span> gcf<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">.</span>gca<span class="ansi-blue-
fg">(</span><span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    927</span>
<span class="ansi-green-intense-fg ansi-bold">    928</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/figure.py</span> in <span class="ansi-cyan-
fg">gca</span><span class="ansi-blue-fg">(self, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1930</span>
<span class="ansi-green-intense-fg ansi-bold">   1931</span>
<span class="ansi-red-fg"># no axes found, so create one which spans
the figure</span>
<span class="ansi-green-fg">-&gt; 1932</span><span class="ansi-red-
fg">         </span><span class="ansi-green-fg">return</span>
self<span class="ansi-blue-fg">.</span>add_subplot<span class="ansi-
blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-
blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span
class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1933</span>
<span class="ansi-green-intense-fg ansi-bold">   1934</span>     <span
class="ansi-green-fg">def</span> sca<span class="ansi-blue-
fg">(</span>self<span class="ansi-blue-fg">,</span> a<span
class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/figure.py</span> in <span class="ansi-cyan-
fg">add_subplot</span><span class="ansi-blue-fg">(self, *args,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1412</span>
self<span class="ansi-blue-fg">.</span>_axstack<span class="ansi-blue-
fg">.</span>remove<span class="ansi-blue-fg">(</span>ax<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1413</span>
<span class="ansi-green-fg">-&gt; 1414</span><span class="ansi-red-
fg">             </span>a <span class="ansi-blue-fg">=</span>
subplot_class_factory<span class="ansi-blue-
fg">(</span>projection_class<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">*</span>args<span class="ansi-blue-
fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1415</span>
<span class="ansi-green-intense-fg ansi-bold">   1416</span>
<span class="ansi-green-fg">return</span> self<span class="ansi-blue-
fg">.</span>_add_axes_internal<span class="ansi-blue-
fg">(</span>key<span class="ansi-blue-fg">,</span> a<span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/axes/_subplots.py</span> in <span class="ansi-
cyan-fg">__init__</span><span class="ansi-blue-fg">(self, fig, *args,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     67</span>
<span class="ansi-green-intense-fg ansi-bold">     68</span>
<span class="ansi-red-fg"># _axes_class is set in the
subplot_class_factory</span>
<span class="ansi-green-fg">---&gt; 69</span><span class="ansi-red-
fg">         </span>self<span class="ansi-blue-
fg">.</span>_axes_class<span class="ansi-blue-
fg">.</span>__init__<span class="ansi-blue-fg">(</span>self<span
class="ansi-blue-fg">,</span> fig<span class="ansi-blue-fg">,</span>
self<span class="ansi-blue-fg">.</span>figbox<span class="ansi-blue-
fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>
<span class="ansi-red-fg"># add a layout box to this, for both the
full axis, and the poss</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span>
<span class="ansi-red-fg"># of the axis.  We need both because the
axes may become smaller</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/axes/_base.py</span> in <span class="ansi-cyan-
fg">__init__</span><span class="ansi-blue-fg">(self, fig, rect,
facecolor, frameon, sharex, sharey, label, xscale, yscale,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    493</span>
self<span class="ansi-blue-fg">.</span>_rasterization_zorder <span
class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    494</span>
self<span class="ansi-blue-fg">.</span>_connected <span class="ansi-
blue-fg">=</span> <span class="ansi-blue-fg">{</span><span
class="ansi-blue-fg">}</span>  <span class="ansi-red-fg"># a dict from
events to (id, func)</span>
<span class="ansi-green-fg">--&gt; 495</span><span class="ansi-red-
fg">         </span>self<span class="ansi-blue-fg">.</span>cla<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    496</span>
<span class="ansi-green-intense-fg ansi-bold">    497</span>
<span class="ansi-red-fg"># funcs used to format x and y - fall back
on major formatters</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/axes/_base.py</span> in <span class="ansi-cyan-
fg">cla</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1089</span>
self<span class="ansi-blue-fg">.</span>set_axis_on<span class="ansi-
blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1090</span>
<span class="ansi-green-fg">-&gt; 1091</span><span class="ansi-red-
fg">         </span>self<span class="ansi-blue-fg">.</span>xaxis<span
class="ansi-blue-fg">.</span>set_clip_path<span class="ansi-blue-
fg">(</span>self<span class="ansi-blue-fg">.</span>patch<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1092</span>
self<span class="ansi-blue-fg">.</span>yaxis<span class="ansi-blue-
fg">.</span>set_clip_path<span class="ansi-blue-fg">(</span>self<span
class="ansi-blue-fg">.</span>patch<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1093</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/axis.py</span> in <span class="ansi-cyan-
fg">set_clip_path</span><span class="ansi-blue-fg">(self, clippath,
transform)</span>
<span class="ansi-green-intense-fg ansi-bold">    946</span>
martist<span class="ansi-blue-fg">.</span>Artist<span class="ansi-
blue-fg">.</span>set_clip_path<span class="ansi-blue-
fg">(</span>self<span class="ansi-blue-fg">,</span> clippath<span
class="ansi-blue-fg">,</span> transform<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    947</span>
<span class="ansi-green-fg">for</span> child <span class="ansi-green-
fg">in</span> self<span class="ansi-blue-fg">.</span>majorTicks <span
class="ansi-blue-fg">+</span> self<span class="ansi-blue-
fg">.</span>minorTicks<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 948</span><span class="ansi-red-
fg">             </span>child<span class="ansi-blue-
fg">.</span>set_clip_path<span class="ansi-blue-
fg">(</span>clippath<span class="ansi-blue-fg">,</span> transform<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    949</span>
self<span class="ansi-blue-fg">.</span>stale <span class="ansi-blue-
fg">=</span> <span class="ansi-green-fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">    950</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/axis.py</span> in <span class="ansi-cyan-
fg">set_clip_path</span><span class="ansi-blue-fg">(self, clippath,
transform)</span>
<span class="ansi-green-intense-fg ansi-bold">    231</span>
<span class="ansi-red-fg"># docstring inherited</span>
<span class="ansi-green-intense-fg ansi-bold">    232</span>
martist<span class="ansi-blue-fg">.</span>Artist<span class="ansi-
blue-fg">.</span>set_clip_path<span class="ansi-blue-
fg">(</span>self<span class="ansi-blue-fg">,</span> clippath<span
class="ansi-blue-fg">,</span> transform<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-fg">--&gt; 233</span><span class="ansi-red-
fg">         </span>self<span class="ansi-blue-
fg">.</span>gridline<span class="ansi-blue-
fg">.</span>set_clip_path<span class="ansi-blue-
fg">(</span>clippath<span class="ansi-blue-fg">,</span> transform<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    234</span>
self<span class="ansi-blue-fg">.</span>stale <span class="ansi-blue-
fg">=</span> <span class="ansi-green-fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">    235</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/artist.py</span> in <span class="ansi-cyan-
fg">set_clip_path</span><span class="ansi-blue-fg">(self, path,
transform)</span>
<span class="ansi-green-intense-fg ansi-bold">    729</span>
<span class="ansi-green-fg">if</span> transform <span class="ansi-
green-fg">is</span> <span class="ansi-green-fg">None</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    730</span>
<span class="ansi-green-fg">if</span> isinstance<span class="ansi-
blue-fg">(</span>path<span class="ansi-blue-fg">,</span>
Rectangle<span class="ansi-blue-fg">)</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 731</span><span class="ansi-red-
fg">                 self.clipbox = TransformedBbox(Bbox.unit(),
</span><span class="ansi-green-intense-fg ansi-bold">    732</span>
path.get_transform())
<span class="ansi-green-intense-fg ansi-bold">    733</span>
self<span class="ansi-blue-fg">.</span>_clippath <span class="ansi-
blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/transforms.py</span> in <span class="ansi-cyan-
fg">unit</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    766</span>
<span class="ansi-blue-fg">(</span><span class="ansi-cyan-
fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-
cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-
blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">    767</span>
&#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 768</span><span class="ansi-red-
fg">         </span><span class="ansi-green-fg">return</span>
Bbox<span class="ansi-blue-fg">(</span>np<span class="ansi-blue-
fg">.</span>array<span class="ansi-blue-fg">(</span><span class="ansi-
blue-fg">[</span><span class="ansi-blue-fg">[</span><span class="ansi-
cyan-fg">0.0</span><span class="ansi-blue-fg">,</span> <span
class="ansi-cyan-fg">0.0</span><span class="ansi-blue-
fg">]</span><span class="ansi-blue-fg">,</span> <span class="ansi-
blue-fg">[</span><span class="ansi-cyan-fg">1.0</span><span
class="ansi-blue-fg">,</span> <span class="ansi-cyan-
fg">1.0</span><span class="ansi-blue-fg">]</span><span class="ansi-
blue-fg">]</span><span class="ansi-blue-fg">,</span> float<span
class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    769</span>
<span class="ansi-green-intense-fg ansi-bold">    770</span>     <span
class="ansi-blue-fg">@</span>staticmethod
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/transforms.py</span> in <span class="ansi-cyan-
fg">__init__</span><span class="ansi-blue-fg">(self, points,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    748</span>
<span class="ansi-red-fg"># default or has been mutated; we store the
orig points to</span>
<span class="ansi-green-intense-fg ansi-bold">    749</span>
<span class="ansi-red-fg"># support the mutated methods</span>
<span class="ansi-green-fg">--&gt; 750</span><span class="ansi-red-
fg">         </span>self<span class="ansi-blue-
fg">.</span>_points_orig <span class="ansi-blue-fg">=</span> self<span
class="ansi-blue-fg">.</span>_points<span class="ansi-blue-
fg">.</span>copy<span class="ansi-blue-fg">(</span><span class="ansi-
blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    751</span>     <span
class="ansi-green-fg">if</span> DEBUG<span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    752</span>
___init__ <span class="ansi-blue-fg">=</span> __init__
<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div>

<div class="highlight"><pre>
&lt;Figure size 1200x800 with 0 Axes&gt;
</pre></div>

<h2>Changing vocabulary size</h2>
<p>We set the target size of the subtoken vocabulary to different values in range
<code>[1000, 15000]</code>.</p>
<p>Model config:</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run2</span><span class="p">(</span><span class="n">vsize</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="bp">None</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">mysubtok</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
      <span class="n">d</span><span class="p">[</span><span class="s1">&#39;target_vocab_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vsize</span>
      <span class="n">d</span><span class="p">[</span><span class="s1">&#39;vocab_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">promise</span><span class="p">,</span> <span class="s1">&#39;vocab.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">vsize</span><span class="p">]</span>
      <span class="n">d</span><span class="p">[</span><span class="s1">&#39;train_data_min_count&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">d</span><span class="p">[</span><span class="s1">&#39;file_byte_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="k">if</span> <span class="n">vsize</span> <span class="o">&gt;</span> <span class="mi">5000</span> <span class="k">else</span> <span class="mf">1e5</span>
      <span class="k">return</span> <span class="n">mkconfig</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redefine</span><span class="p">(</span><span class="n">all_nl2bashsubtok</span><span class="p">,</span><span class="n">_config</span><span class="p">)(</span><span class="n">m</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">mytransformer</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
      <span class="n">c</span><span class="p">[</span><span class="s1">&#39;train_steps&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="mi">5000</span>
      <span class="n">c</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;beam_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">3</span> <span class="c1"># As in Tellina paper</span>
      <span class="k">return</span> <span class="n">mkconfig</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redefine</span><span class="p">(</span><span class="n">transformer_wmt</span><span class="p">,</span><span class="n">_config</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="n">mysubtok</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>

  <span class="k">return</span> <span class="n">mysubtok</span><span class="p">,</span> <span class="n">mytransformer</span>
</pre></div>

<p>Results:</p>

<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Training steps&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;BLEU&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unshuffled_bleu</span><span class="p">)),</span> <span class="n">unshuffled_bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;Unshuffled transformer&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">baseline_bleu</span><span class="p">)),</span> <span class="n">baseline_bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;Baseline transformer&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="n">out</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;STAGEDML_ROOT&#39;</span><span class="p">],</span><span class="s1">&#39;_experiments&#39;</span><span class="p">,</span><span class="s1">&#39;nl2bash&#39;</span><span class="p">,</span><span class="s1">&#39;vsize&#39;</span><span class="p">)</span>
<span class="n">makedirs</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">vsize</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">1700</span> <span class="p">])</span> <span class="p">:</span>
  <span class="n">mysubtok</span><span class="p">,</span><span class="n">mytransformer</span><span class="o">=</span><span class="n">run2</span><span class="p">(</span><span class="n">vsize</span><span class="p">)</span>
  <span class="n">rref</span><span class="o">=</span><span class="n">realize</span><span class="p">(</span><span class="n">instantiate</span><span class="p">(</span><span class="n">mytransformer</span><span class="p">))</span>
  <span class="n">mksymlink</span><span class="p">(</span><span class="n">rref</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">vsize</span><span class="p">,</span> <span class="n">withtime</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">bleu</span><span class="o">=</span><span class="n">read_tensorflow_log</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">rref2path</span><span class="p">(</span><span class="n">rref</span><span class="p">),</span><span class="s1">&#39;eval&#39;</span><span class="p">),</span> <span class="s1">&#39;bleu_cased&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bleu</span><span class="p">)),</span> <span class="n">bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;vsize-{vsize}&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
Error in callback &lt;function flush_figures at 0x7ffb24097a60&gt;
(for post_execute):
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">NameError</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-756adc09159f&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> plt<span
class="ansi-blue-fg">.</span>title<span class="ansi-blue-
fg">(</span><span class="ansi-blue-fg">&#34;BLEU&#34;</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-
fg"> </span>plt<span class="ansi-blue-fg">.</span>plot<span
class="ansi-blue-fg">(</span>range<span class="ansi-blue-
fg">(</span>len<span class="ansi-blue-fg">(</span>unshuffled_bleu<span
class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">,</span> unshuffled_bleu<span class="ansi-blue-
fg">,</span> label<span class="ansi-blue-fg">=</span><span
class="ansi-blue-fg">f&#39;Unshuffled transformer&#39;</span><span
class="ansi-blue-fg">,</span> color<span class="ansi-blue-
fg">=</span><span class="ansi-blue-fg">&#39;red&#39;</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> plt<span
class="ansi-blue-fg">.</span>plot<span class="ansi-blue-
fg">(</span>range<span class="ansi-blue-fg">(</span>len<span
class="ansi-blue-fg">(</span>baseline_bleu<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-
fg">,</span> baseline_bleu<span class="ansi-blue-fg">,</span>
label<span class="ansi-blue-fg">=</span><span class="ansi-blue-
fg">f&#39;Baseline transformer&#39;</span><span class="ansi-blue-
fg">,</span> color<span class="ansi-blue-fg">=</span><span
class="ansi-blue-fg">&#39;orange&#39;</span><span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>
<span class="ansi-red-fg">NameError</span>: name
&#39;unshuffled_bleu&#39; is not defined
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">KeyboardInterrupt</span>
Traceback (most recent call last)<span class="ansi-green-
fg">/usr/local/lib/python3.6/dist-
packages/ipykernel/pylab/backend_inline.py</span> in <span
class="ansi-cyan-fg">flush_figures</span><span class="ansi-blue-
fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>
<span class="ansi-red-fg"># ignore the tracking, just draw and close
all figures</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>
<span class="ansi-green-fg">try</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
show<span class="ansi-blue-fg">(</span><span class="ansi-green-
fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>
<span class="ansi-green-fg">except</span> Exception <span class="ansi-
green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>
<span class="ansi-red-fg"># safely show traceback if in IPython, else
raise</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/ipykernel/pylab/backend_inline.py</span> in <span
class="ansi-cyan-fg">show</span><span class="ansi-blue-fg">(close,
block)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
display(
<span class="ansi-green-intense-fg ansi-bold">     38</span>
figure_manager<span class="ansi-blue-fg">.</span>canvas<span
class="ansi-blue-fg">.</span>figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">---&gt; 39</span><span class="ansi-red-
fg">                 </span>metadata<span class="ansi-blue-
fg">=</span>_fetch_figure_metadata<span class="ansi-blue-
fg">(</span>figure_manager<span class="ansi-blue-
fg">.</span>canvas<span class="ansi-blue-fg">.</span>figure<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
)
<span class="ansi-green-intense-fg ansi-bold">     41</span>     <span
class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/display.py</span> in <span class="ansi-cyan-
fg">display</span><span class="ansi-blue-fg">(include, exclude,
metadata, transient, display_id, *objs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    304</span>
publish_display_data<span class="ansi-blue-fg">(</span>data<span
class="ansi-blue-fg">=</span>obj<span class="ansi-blue-fg">,</span>
metadata<span class="ansi-blue-fg">=</span>metadata<span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    305</span>
<span class="ansi-green-fg">else</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 306</span><span class="ansi-red-
fg">             </span>format_dict<span class="ansi-blue-fg">,</span>
md_dict <span class="ansi-blue-fg">=</span> format<span class="ansi-
blue-fg">(</span>obj<span class="ansi-blue-fg">,</span> include<span
class="ansi-blue-fg">=</span>include<span class="ansi-blue-
fg">,</span> exclude<span class="ansi-blue-fg">=</span>exclude<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    307</span>
<span class="ansi-green-fg">if</span> <span class="ansi-green-
fg">not</span> format_dict<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    308</span>
<span class="ansi-red-fg"># nothing to display (e.g. _ipython_display_
took over)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">format</span><span class="ansi-blue-fg">(self, obj, include,
exclude)</span>
<span class="ansi-green-intense-fg ansi-bold">    178</span>
md <span class="ansi-blue-fg">=</span> <span class="ansi-green-
fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    179</span>
<span class="ansi-green-fg">try</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 180</span><span class="ansi-red-
fg">                 </span>data <span class="ansi-blue-fg">=</span>
formatter<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    181</span>
<span class="ansi-green-fg">except</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    182</span>
<span class="ansi-red-fg"># FIXME: log the exception</span>
<span class="ansi-green-fg">&lt;/usr/local/lib/python3.6/dist-
packages/decorator.py:decorator-gen-10&gt;</span> in <span
class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self,
obj)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">catch_format_error</span><span class="ansi-blue-fg">(method, self,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    222</span>     <span
class="ansi-blue-fg">&#34;&#34;&#34;show traceback on failed format
call&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    223</span>     <span
class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 224</span><span class="ansi-red-
fg">         </span>r <span class="ansi-blue-fg">=</span> method<span
class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">*</span>args<span class="ansi-blue-
fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    225</span>     <span
class="ansi-green-fg">except</span> NotImplementedError<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    226</span>
<span class="ansi-red-fg"># don&#39;t warn on
NotImplementedErrors</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">__call__</span><span class="ansi-blue-fg">(self, obj)</span>
<span class="ansi-green-intense-fg ansi-bold">    339</span>
<span class="ansi-green-fg">pass</span>
<span class="ansi-green-intense-fg ansi-bold">    340</span>
<span class="ansi-green-fg">else</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 341</span><span class="ansi-red-
fg">                 </span><span class="ansi-green-fg">return</span>
printer<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    342</span>
<span class="ansi-red-fg"># Finally look for special method
names</span>
<span class="ansi-green-intense-fg ansi-bold">    343</span>
method <span class="ansi-blue-fg">=</span> get_real_method<span
class="ansi-blue-fg">(</span>obj<span class="ansi-blue-fg">,</span>
self<span class="ansi-blue-fg">.</span>print_method<span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/pylabtools.py</span> in <span class="ansi-cyan-
fg">&lt;lambda&gt;</span><span class="ansi-blue-fg">(fig)</span>
<span class="ansi-green-intense-fg ansi-bold">    242</span>
<span class="ansi-green-intense-fg ansi-bold">    243</span>     <span
class="ansi-green-fg">if</span> <span class="ansi-blue-
fg">&#39;png&#39;</span> <span class="ansi-green-fg">in</span>
formats<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 244</span><span class="ansi-red-
fg">         </span>png_formatter<span class="ansi-blue-
fg">.</span>for_type<span class="ansi-blue-fg">(</span>Figure<span
class="ansi-blue-fg">,</span> <span class="ansi-green-
fg">lambda</span> fig<span class="ansi-blue-fg">:</span>
print_figure<span class="ansi-blue-fg">(</span>fig<span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">&#39;png&#39;</span><span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    245</span>     <span
class="ansi-green-fg">if</span> <span class="ansi-blue-
fg">&#39;retina&#39;</span> <span class="ansi-green-fg">in</span>
formats <span class="ansi-green-fg">or</span> <span class="ansi-blue-
fg">&#39;png2x&#39;</span> <span class="ansi-green-fg">in</span>
formats<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    246</span>
png_formatter<span class="ansi-blue-fg">.</span>for_type<span
class="ansi-blue-fg">(</span>Figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">lambda</span> fig<span class="ansi-blue-
fg">:</span> retina_figure<span class="ansi-blue-fg">(</span>fig<span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/pylabtools.py</span> in <span class="ansi-cyan-
fg">print_figure</span><span class="ansi-blue-fg">(fig, fmt,
bbox_inches, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    126</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>
bytes_io <span class="ansi-blue-fg">=</span> BytesIO<span class="ansi-
blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 128</span><span class="ansi-red-
fg">     </span>fig<span class="ansi-blue-fg">.</span>canvas<span
class="ansi-blue-fg">.</span>print_figure<span class="ansi-blue-
fg">(</span>bytes_io<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    129</span>     data
<span class="ansi-blue-fg">=</span> bytes_io<span class="ansi-blue-
fg">.</span>getvalue<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span>     <span
class="ansi-green-fg">if</span> fmt <span class="ansi-blue-
fg">==</span> <span class="ansi-blue-fg">&#39;svg&#39;</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backend_bases.py</span> in <span class="ansi-cyan-
fg">print_figure</span><span class="ansi-blue-fg">(self, filename,
dpi, facecolor, edgecolor, orientation, format, bbox_inches,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   2054</span>
orientation<span class="ansi-blue-fg">=</span>orientation<span
class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2055</span>
dryrun<span class="ansi-blue-fg">=</span><span class="ansi-green-
fg">True</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">-&gt; 2056</span><span class="ansi-red-
fg">                         **kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">   2057</span>
renderer <span class="ansi-blue-fg">=</span> self<span class="ansi-
blue-fg">.</span>figure<span class="ansi-blue-
fg">.</span>_cachedRenderer
<span class="ansi-green-intense-fg ansi-bold">   2058</span>
bbox_artists <span class="ansi-blue-fg">=</span> kwargs<span
class="ansi-blue-fg">.</span>pop<span class="ansi-blue-
fg">(</span><span class="ansi-blue-
fg">&#34;bbox_extra_artists&#34;</span><span class="ansi-blue-
fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backends/backend_agg.py</span> in <span
class="ansi-cyan-fg">print_png</span><span class="ansi-blue-fg">(self,
filename_or_obj, metadata, pil_kwargs, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    530</span>
cbook<span class="ansi-blue-fg">.</span>open_file_cm<span class="ansi-
blue-fg">(</span>filename_or_obj<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">&#34;wb&#34;</span><span class="ansi-blue-
fg">)</span> <span class="ansi-green-fg">as</span> fh<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    531</span>
_png.write_png(renderer._renderer, fh,
<span class="ansi-green-fg">--&gt; 532</span><span class="ansi-red-
fg">                                self.figure.dpi,
metadata=metadata)
</span><span class="ansi-green-intense-fg ansi-bold">    533</span>
<span class="ansi-green-intense-fg ansi-bold">    534</span>     <span
class="ansi-green-fg">def</span> print_to_buffer<span class="ansi-
blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div>

<h2>Single-char punctuation tokens</h2>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylightnix</span> <span class="kn">import</span> <span class="n">match_some</span><span class="p">,</span> <span class="n">realizeMany</span><span class="p">,</span> <span class="n">instantiate</span><span class="p">,</span> <span class="n">redefine</span><span class="p">,</span> <span class="n">mkconfig</span><span class="p">,</span> <span class="n">mksymlink</span>
<span class="kn">from</span> <span class="nn">stagedml.stages.all</span> <span class="kn">import</span> <span class="n">transformer_wmt</span><span class="p">,</span> <span class="n">all_nl2bashsubtok</span>
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">KeyboardInterrupt</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-54e18eec681a&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span
class="ansi-green-fg">from</span> pylightnix <span class="ansi-green-
fg">import</span> match_some<span class="ansi-blue-fg">,</span>
realizeMany<span class="ansi-blue-fg">,</span> instantiate<span
class="ansi-blue-fg">,</span> redefine<span class="ansi-blue-
fg">,</span> mkconfig<span class="ansi-blue-fg">,</span> mksymlink
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-
fg"> </span><span class="ansi-green-fg">from</span> stagedml<span
class="ansi-blue-fg">.</span>stages<span class="ansi-blue-
fg">.</span>all <span class="ansi-green-fg">import</span>
transformer_wmt<span class="ansi-blue-fg">,</span> all_nl2bashsubtok
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/stages/all.py</span> in <span class="ansi-cyan-
fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     23</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-
fg">.</span>bert_finetune_squad <span class="ansi-green-
fg">import</span> bert_finetune_squad11
<span class="ansi-green-intense-fg ansi-bold">     24</span> <span
class="ansi-red-fg"># from stagedml.stages.nl2bash.all import
nl2bash</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-
fg"> </span><span class="ansi-green-fg">from</span> stagedml<span
class="ansi-blue-fg">.</span>stages<span class="ansi-blue-
fg">.</span>fetchnl2bash <span class="ansi-green-fg">import</span>
fetchnl2bash<span class="ansi-blue-fg">,</span> nl2bashSubtok
<span class="ansi-green-intense-fg ansi-bold">     26</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-fg">.</span>fetchwmt <span
class="ansi-green-fg">import</span> wmtsubtok<span class="ansi-blue-
fg">,</span> wmtsubtokInv
<span class="ansi-green-intense-fg ansi-bold">     27</span> <span
class="ansi-green-fg">from</span> stagedml<span class="ansi-blue-
fg">.</span>stages<span class="ansi-blue-fg">.</span>transformer_wmt
<span class="ansi-green-fg">import</span> transformer_wmt
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/stagedml/stages/fetchnl2bash.py</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     17</span>
alphanumeric_char_set, RESERVED_TOKENS )
<span class="ansi-green-intense-fg ansi-bold">     18</span>
<span class="ansi-green-fg">---&gt; 19</span><span class="ansi-red-
fg"> </span>BASH_CHAR_SET<span class="ansi-blue-fg">:</span>Set<span
class="ansi-blue-fg">[</span>Any<span class="ansi-blue-fg">]</span>
<span class="ansi-blue-fg">=</span> alphanumeric_char_set<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span
class="ansi-blue-fg">|</span> set<span class="ansi-blue-
fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-
fg">&#39;-&#39;</span><span class="ansi-blue-fg">,</span><span
class="ansi-blue-fg">&#39;+&#39;</span><span class="ansi-blue-
fg">,</span><span class="ansi-blue-fg">&#39;,&#39;</span><span
class="ansi-blue-fg">,</span><span class="ansi-blue-
fg">&#39;.&#39;</span><span class="ansi-blue-fg">]</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     20</span>
<span class="ansi-green-intense-fg ansi-bold">     21</span> <span
class="ansi-green-fg">def</span> non_alphanumeric_chars<span
class="ansi-blue-fg">(</span>filepath<span class="ansi-blue-
fg">:</span>str<span class="ansi-blue-fg">)</span><span class="ansi-
blue-fg">-&gt;</span>Set<span class="ansi-blue-fg">[</span>str<span
class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">~/.local/lib/python3.6/site-
packages/official/nlp/transformer/utils/tokenizer.py</span> in <span
class="ansi-cyan-fg">alphanumeric_char_set</span><span class="ansi-
blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span> <span
class="ansi-green-fg">def</span> alphanumeric_char_set<span
class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>   return
set(
<span class="ansi-green-fg">---&gt; 50</span><span class="ansi-red-
fg">     </span>six<span class="ansi-blue-fg">.</span>unichr<span
class="ansi-blue-fg">(</span>i<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">for</span> i <span class="ansi-green-
fg">in</span> xrange<span class="ansi-blue-fg">(</span>sys<span
class="ansi-blue-fg">.</span>maxunicode<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>     if
(unicodedata.category(six.unichr(i)).startswith(&#34;L&#34;) or
<span class="ansi-green-intense-fg ansi-bold">     52</span>
unicodedata.category(six.unichr(i)).startswith(&#34;N&#34;)))
<span class="ansi-green-fg">~/.local/lib/python3.6/site-
packages/official/nlp/transformer/utils/tokenizer.py</span> in <span
class="ansi-cyan-fg">&lt;genexpr&gt;</span><span class="ansi-blue-
fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>   return
set(
<span class="ansi-green-intense-fg ansi-bold">     50</span>
six<span class="ansi-blue-fg">.</span>unichr<span class="ansi-blue-
fg">(</span>i<span class="ansi-blue-fg">)</span> <span class="ansi-
green-fg">for</span> i <span class="ansi-green-fg">in</span>
xrange<span class="ansi-blue-fg">(</span>sys<span class="ansi-blue-
fg">.</span>maxunicode<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 51</span><span class="ansi-red-
fg">     if
(unicodedata.category(six.unichr(i)).startswith(&#34;L&#34;) or
</span><span class="ansi-green-intense-fg ansi-bold">     52</span>
unicodedata.category(six.unichr(i)).startswith(&#34;N&#34;)))
<span class="ansi-green-intense-fg ansi-bold">     53</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div>

<p>In addition to the modifications that we made in Experiment 2, we now attempt to
force the tokenizer to produce single-char tokens for punctuation.</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">singlechar_subtok</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
  <span class="n">vsize</span><span class="o">=</span><span class="mi">10000</span>
  <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;target_vocab_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vsize</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;vocab_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">promise</span><span class="p">,</span> <span class="s1">&#39;vocab.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">vsize</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;no_slave_multichar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;train_data_min_count&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
    <span class="k">return</span> <span class="n">mkconfig</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">redefine</span><span class="p">(</span><span class="n">all_nl2bashsubtok</span><span class="p">,</span><span class="n">_config</span><span class="p">)(</span><span class="n">m</span><span class="p">)</span>
</pre></div>



<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">singlechar_transformer</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;train_steps&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="mi">5000</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;beam_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">3</span> <span class="c1"># As in Tellina paper</span>
    <span class="k">return</span> <span class="n">mkconfig</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">redefine</span><span class="p">(</span><span class="n">transformer_wmt</span><span class="p">,</span>
                  <span class="n">new_config</span><span class="o">=</span><span class="n">_config</span><span class="p">,</span>
                  <span class="n">new_matcher</span><span class="o">=</span><span class="n">match_some</span><span class="p">())(</span><span class="n">m</span><span class="p">,</span> <span class="n">singlechar_subtok</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">num_instances</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

<p>Results:</p>

<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Single-char punctuation tokens&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;BLEU&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unshuffled_bleu</span><span class="p">)),</span> <span class="n">unshuffled_bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;Unshuffled transformer&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">baseline_bleu</span><span class="p">)),</span> <span class="n">baseline_bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;Baseline transformer&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="n">out</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;STAGEDML_ROOT&#39;</span><span class="p">],</span><span class="s1">&#39;_experiments&#39;</span><span class="p">,</span><span class="s1">&#39;nl2bash&#39;</span><span class="p">,</span><span class="s1">&#39;singlechar&#39;</span><span class="p">)</span>
<span class="n">makedirs</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">rref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">realizeMany</span><span class="p">(</span><span class="n">instantiate</span><span class="p">(</span><span class="n">singlechar_transformer</span><span class="p">))):</span>
  <span class="n">mksymlink</span><span class="p">(</span><span class="n">rref</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;run-{i}&#39;</span><span class="p">,</span> <span class="n">withtime</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">bleu</span><span class="o">=</span><span class="n">read_tensorflow_log</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">rref2path</span><span class="p">(</span><span class="n">rref</span><span class="p">),</span><span class="s1">&#39;eval&#39;</span><span class="p">),</span> <span class="s1">&#39;bleu_cased&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bleu</span><span class="p">)),</span> <span class="n">bleu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;run-{i}&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
Error in callback &lt;function flush_figures at 0x7ffb24097a60&gt;
(for post_execute):
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">NameError</span>
Traceback (most recent call last)<span class="ansi-green-
fg">&lt;ipython-input-1-7785cf2a5bae&gt;</span> in <span class="ansi-
cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> plt<span
class="ansi-blue-fg">.</span>title<span class="ansi-blue-
fg">(</span><span class="ansi-blue-fg">&#34;BLEU&#34;</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-
fg"> </span>plt<span class="ansi-blue-fg">.</span>plot<span
class="ansi-blue-fg">(</span>range<span class="ansi-blue-
fg">(</span>len<span class="ansi-blue-fg">(</span>unshuffled_bleu<span
class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">,</span> unshuffled_bleu<span class="ansi-blue-
fg">,</span> label<span class="ansi-blue-fg">=</span><span
class="ansi-blue-fg">f&#39;Unshuffled transformer&#39;</span><span
class="ansi-blue-fg">,</span> color<span class="ansi-blue-
fg">=</span><span class="ansi-blue-fg">&#39;red&#39;</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> plt<span
class="ansi-blue-fg">.</span>plot<span class="ansi-blue-
fg">(</span>range<span class="ansi-blue-fg">(</span>len<span
class="ansi-blue-fg">(</span>baseline_bleu<span class="ansi-blue-
fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-
fg">,</span> baseline_bleu<span class="ansi-blue-fg">,</span>
label<span class="ansi-blue-fg">=</span><span class="ansi-blue-
fg">f&#39;Baseline transformer&#39;</span><span class="ansi-blue-
fg">,</span> color<span class="ansi-blue-fg">=</span><span
class="ansi-blue-fg">&#39;orange&#39;</span><span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>
<span class="ansi-red-fg">NameError</span>: name
&#39;unshuffled_bleu&#39; is not defined
</pre></div>

<div class="highlight"><pre>
<span class="ansi-red-
fg">---------------------------------------------------------------------------</span><span
class="ansi-red-fg">KeyboardInterrupt</span>
Traceback (most recent call last)<span class="ansi-green-
fg">/usr/local/lib/python3.6/dist-
packages/ipykernel/pylab/backend_inline.py</span> in <span
class="ansi-cyan-fg">flush_figures</span><span class="ansi-blue-
fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>
<span class="ansi-red-fg"># ignore the tracking, just draw and close
all figures</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>
<span class="ansi-green-fg">try</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-
fg">             </span><span class="ansi-green-fg">return</span>
show<span class="ansi-blue-fg">(</span><span class="ansi-green-
fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>
<span class="ansi-green-fg">except</span> Exception <span class="ansi-
green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>
<span class="ansi-red-fg"># safely show traceback if in IPython, else
raise</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/ipykernel/pylab/backend_inline.py</span> in <span
class="ansi-cyan-fg">show</span><span class="ansi-blue-fg">(close,
block)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>
display(
<span class="ansi-green-intense-fg ansi-bold">     38</span>
figure_manager<span class="ansi-blue-fg">.</span>canvas<span
class="ansi-blue-fg">.</span>figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">---&gt; 39</span><span class="ansi-red-
fg">                 </span>metadata<span class="ansi-blue-
fg">=</span>_fetch_figure_metadata<span class="ansi-blue-
fg">(</span>figure_manager<span class="ansi-blue-
fg">.</span>canvas<span class="ansi-blue-fg">.</span>figure<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>
)
<span class="ansi-green-intense-fg ansi-bold">     41</span>     <span
class="ansi-green-fg">finally</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/display.py</span> in <span class="ansi-cyan-
fg">display</span><span class="ansi-blue-fg">(include, exclude,
metadata, transient, display_id, *objs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    304</span>
publish_display_data<span class="ansi-blue-fg">(</span>data<span
class="ansi-blue-fg">=</span>obj<span class="ansi-blue-fg">,</span>
metadata<span class="ansi-blue-fg">=</span>metadata<span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    305</span>
<span class="ansi-green-fg">else</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 306</span><span class="ansi-red-
fg">             </span>format_dict<span class="ansi-blue-fg">,</span>
md_dict <span class="ansi-blue-fg">=</span> format<span class="ansi-
blue-fg">(</span>obj<span class="ansi-blue-fg">,</span> include<span
class="ansi-blue-fg">=</span>include<span class="ansi-blue-
fg">,</span> exclude<span class="ansi-blue-fg">=</span>exclude<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    307</span>
<span class="ansi-green-fg">if</span> <span class="ansi-green-
fg">not</span> format_dict<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    308</span>
<span class="ansi-red-fg"># nothing to display (e.g. _ipython_display_
took over)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">format</span><span class="ansi-blue-fg">(self, obj, include,
exclude)</span>
<span class="ansi-green-intense-fg ansi-bold">    178</span>
md <span class="ansi-blue-fg">=</span> <span class="ansi-green-
fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    179</span>
<span class="ansi-green-fg">try</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 180</span><span class="ansi-red-
fg">                 </span>data <span class="ansi-blue-fg">=</span>
formatter<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    181</span>
<span class="ansi-green-fg">except</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    182</span>
<span class="ansi-red-fg"># FIXME: log the exception</span>
<span class="ansi-green-fg">&lt;/usr/local/lib/python3.6/dist-
packages/decorator.py:decorator-gen-10&gt;</span> in <span
class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self,
obj)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">catch_format_error</span><span class="ansi-blue-fg">(method, self,
*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    222</span>     <span
class="ansi-blue-fg">&#34;&#34;&#34;show traceback on failed format
call&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    223</span>     <span
class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 224</span><span class="ansi-red-
fg">         </span>r <span class="ansi-blue-fg">=</span> method<span
class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">*</span>args<span class="ansi-blue-
fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    225</span>     <span
class="ansi-green-fg">except</span> NotImplementedError<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    226</span>
<span class="ansi-red-fg"># don&#39;t warn on
NotImplementedErrors</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/formatters.py</span> in <span class="ansi-cyan-
fg">__call__</span><span class="ansi-blue-fg">(self, obj)</span>
<span class="ansi-green-intense-fg ansi-bold">    339</span>
<span class="ansi-green-fg">pass</span>
<span class="ansi-green-intense-fg ansi-bold">    340</span>
<span class="ansi-green-fg">else</span><span class="ansi-blue-
fg">:</span>
<span class="ansi-green-fg">--&gt; 341</span><span class="ansi-red-
fg">                 </span><span class="ansi-green-fg">return</span>
printer<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-
fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    342</span>
<span class="ansi-red-fg"># Finally look for special method
names</span>
<span class="ansi-green-intense-fg ansi-bold">    343</span>
method <span class="ansi-blue-fg">=</span> get_real_method<span
class="ansi-blue-fg">(</span>obj<span class="ansi-blue-fg">,</span>
self<span class="ansi-blue-fg">.</span>print_method<span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/pylabtools.py</span> in <span class="ansi-cyan-
fg">&lt;lambda&gt;</span><span class="ansi-blue-fg">(fig)</span>
<span class="ansi-green-intense-fg ansi-bold">    242</span>
<span class="ansi-green-intense-fg ansi-bold">    243</span>     <span
class="ansi-green-fg">if</span> <span class="ansi-blue-
fg">&#39;png&#39;</span> <span class="ansi-green-fg">in</span>
formats<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 244</span><span class="ansi-red-
fg">         </span>png_formatter<span class="ansi-blue-
fg">.</span>for_type<span class="ansi-blue-fg">(</span>Figure<span
class="ansi-blue-fg">,</span> <span class="ansi-green-
fg">lambda</span> fig<span class="ansi-blue-fg">:</span>
print_figure<span class="ansi-blue-fg">(</span>fig<span class="ansi-
blue-fg">,</span> <span class="ansi-blue-fg">&#39;png&#39;</span><span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    245</span>     <span
class="ansi-green-fg">if</span> <span class="ansi-blue-
fg">&#39;retina&#39;</span> <span class="ansi-green-fg">in</span>
formats <span class="ansi-green-fg">or</span> <span class="ansi-blue-
fg">&#39;png2x&#39;</span> <span class="ansi-green-fg">in</span>
formats<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    246</span>
png_formatter<span class="ansi-blue-fg">.</span>for_type<span
class="ansi-blue-fg">(</span>Figure<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">lambda</span> fig<span class="ansi-blue-
fg">:</span> retina_figure<span class="ansi-blue-fg">(</span>fig<span
class="ansi-blue-fg">,</span> <span class="ansi-blue-
fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/IPython/core/pylabtools.py</span> in <span class="ansi-cyan-
fg">print_figure</span><span class="ansi-blue-fg">(fig, fmt,
bbox_inches, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    126</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>
bytes_io <span class="ansi-blue-fg">=</span> BytesIO<span class="ansi-
blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 128</span><span class="ansi-red-
fg">     </span>fig<span class="ansi-blue-fg">.</span>canvas<span
class="ansi-blue-fg">.</span>print_figure<span class="ansi-blue-
fg">(</span>bytes_io<span class="ansi-blue-fg">,</span> <span
class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    129</span>     data
<span class="ansi-blue-fg">=</span> bytes_io<span class="ansi-blue-
fg">.</span>getvalue<span class="ansi-blue-fg">(</span><span
class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span>     <span
class="ansi-green-fg">if</span> fmt <span class="ansi-blue-
fg">==</span> <span class="ansi-blue-fg">&#39;svg&#39;</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backend_bases.py</span> in <span class="ansi-cyan-
fg">print_figure</span><span class="ansi-blue-fg">(self, filename,
dpi, facecolor, edgecolor, orientation, format, bbox_inches,
**kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   2054</span>
orientation<span class="ansi-blue-fg">=</span>orientation<span
class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2055</span>
dryrun<span class="ansi-blue-fg">=</span><span class="ansi-green-
fg">True</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">-&gt; 2056</span><span class="ansi-red-
fg">                         **kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">   2057</span>
renderer <span class="ansi-blue-fg">=</span> self<span class="ansi-
blue-fg">.</span>figure<span class="ansi-blue-
fg">.</span>_cachedRenderer
<span class="ansi-green-intense-fg ansi-bold">   2058</span>
bbox_artists <span class="ansi-blue-fg">=</span> kwargs<span
class="ansi-blue-fg">.</span>pop<span class="ansi-blue-
fg">(</span><span class="ansi-blue-
fg">&#34;bbox_extra_artists&#34;</span><span class="ansi-blue-
fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-
blue-fg">)</span>
<span class="ansi-green-fg">/usr/local/lib/python3.6/dist-
packages/matplotlib/backends/backend_agg.py</span> in <span
class="ansi-cyan-fg">print_png</span><span class="ansi-blue-fg">(self,
filename_or_obj, metadata, pil_kwargs, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    530</span>
cbook<span class="ansi-blue-fg">.</span>open_file_cm<span class="ansi-
blue-fg">(</span>filename_or_obj<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">&#34;wb&#34;</span><span class="ansi-blue-
fg">)</span> <span class="ansi-green-fg">as</span> fh<span
class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    531</span>
_png.write_png(renderer._renderer, fh,
<span class="ansi-green-fg">--&gt; 532</span><span class="ansi-red-
fg">                                self.figure.dpi,
metadata=metadata)
</span><span class="ansi-green-intense-fg ansi-bold">    533</span>
<span class="ansi-green-intense-fg ansi-bold">    534</span>     <span
class="ansi-green-fg">def</span> print_to_buffer<span class="ansi-
blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span
class="ansi-blue-fg">:</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div>

<p>Unfortunately, suppressing punktuation seems to have no effect or the effect is
negative.</p>
<h2>References</h2>
    <HR/>
    <div class="footer">
      <p>Published from <a href="Report.md.in">Report.md.in</a>
    using <a href="http://mpastell.com/pweave">Pweave</a> 0.30.3
    on 14-03-2020.<p></div>

            </div>
        </div>
    </div>
  </BODY>
</HTML>
